<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chrome Extension（扩展程序）开发 | IMAGINE&#39;S BLOG</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/vuepressblog/img/favicon.ico">
    <meta name="description" content="web前端技术博客,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,React,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/vuepressblog/assets/css/0.styles.984cdcb9.css" as="style"><link rel="preload" href="/vuepressblog/assets/js/app.0a5890d8.js" as="script"><link rel="preload" href="/vuepressblog/assets/js/2.b3d401a1.js" as="script"><link rel="preload" href="/vuepressblog/assets/js/67.f61ce51a.js" as="script"><link rel="prefetch" href="/vuepressblog/assets/js/10.40657e38.js"><link rel="prefetch" href="/vuepressblog/assets/js/11.39489e69.js"><link rel="prefetch" href="/vuepressblog/assets/js/12.c3be5662.js"><link rel="prefetch" href="/vuepressblog/assets/js/13.d949cc45.js"><link rel="prefetch" href="/vuepressblog/assets/js/14.4f5060b3.js"><link rel="prefetch" href="/vuepressblog/assets/js/15.78fa4143.js"><link rel="prefetch" href="/vuepressblog/assets/js/16.9503d511.js"><link rel="prefetch" href="/vuepressblog/assets/js/17.0fcfba30.js"><link rel="prefetch" href="/vuepressblog/assets/js/18.1b25e780.js"><link rel="prefetch" href="/vuepressblog/assets/js/19.16021f7f.js"><link rel="prefetch" href="/vuepressblog/assets/js/20.65e656d1.js"><link rel="prefetch" href="/vuepressblog/assets/js/21.5ee8d2f0.js"><link rel="prefetch" href="/vuepressblog/assets/js/22.204d01b0.js"><link rel="prefetch" href="/vuepressblog/assets/js/23.42a81649.js"><link rel="prefetch" href="/vuepressblog/assets/js/24.6f4fea18.js"><link rel="prefetch" href="/vuepressblog/assets/js/25.1cfec83f.js"><link rel="prefetch" href="/vuepressblog/assets/js/26.06aae0dc.js"><link rel="prefetch" href="/vuepressblog/assets/js/27.2593b9e4.js"><link rel="prefetch" href="/vuepressblog/assets/js/28.f44edad4.js"><link rel="prefetch" href="/vuepressblog/assets/js/29.d9f77584.js"><link rel="prefetch" href="/vuepressblog/assets/js/3.5f30fc01.js"><link rel="prefetch" href="/vuepressblog/assets/js/30.d7f65eef.js"><link rel="prefetch" href="/vuepressblog/assets/js/31.c812264a.js"><link rel="prefetch" href="/vuepressblog/assets/js/32.208e26a8.js"><link rel="prefetch" href="/vuepressblog/assets/js/33.eeecbcd6.js"><link rel="prefetch" href="/vuepressblog/assets/js/34.8f549993.js"><link rel="prefetch" href="/vuepressblog/assets/js/35.5d9b1c1b.js"><link rel="prefetch" href="/vuepressblog/assets/js/36.ef2845b4.js"><link rel="prefetch" href="/vuepressblog/assets/js/37.ee552734.js"><link rel="prefetch" href="/vuepressblog/assets/js/38.a129ceab.js"><link rel="prefetch" href="/vuepressblog/assets/js/39.84d5d94f.js"><link rel="prefetch" href="/vuepressblog/assets/js/4.6f6d66aa.js"><link rel="prefetch" href="/vuepressblog/assets/js/40.57047c95.js"><link rel="prefetch" href="/vuepressblog/assets/js/41.0d03e5a0.js"><link rel="prefetch" href="/vuepressblog/assets/js/42.b203e8d9.js"><link rel="prefetch" href="/vuepressblog/assets/js/43.d3def544.js"><link rel="prefetch" href="/vuepressblog/assets/js/44.317f60c8.js"><link rel="prefetch" href="/vuepressblog/assets/js/45.3faece9b.js"><link rel="prefetch" href="/vuepressblog/assets/js/46.02850e8f.js"><link rel="prefetch" href="/vuepressblog/assets/js/47.c5228fde.js"><link rel="prefetch" href="/vuepressblog/assets/js/48.c5484757.js"><link rel="prefetch" href="/vuepressblog/assets/js/49.1c6b1117.js"><link rel="prefetch" href="/vuepressblog/assets/js/5.eec1d419.js"><link rel="prefetch" href="/vuepressblog/assets/js/50.15a97561.js"><link rel="prefetch" href="/vuepressblog/assets/js/51.334ee22d.js"><link rel="prefetch" href="/vuepressblog/assets/js/52.bbf3bd68.js"><link rel="prefetch" href="/vuepressblog/assets/js/53.1b313389.js"><link rel="prefetch" href="/vuepressblog/assets/js/54.19e5306e.js"><link rel="prefetch" href="/vuepressblog/assets/js/55.c9dfb67a.js"><link rel="prefetch" href="/vuepressblog/assets/js/56.87243f14.js"><link rel="prefetch" href="/vuepressblog/assets/js/57.aec46cbd.js"><link rel="prefetch" href="/vuepressblog/assets/js/58.78e019e7.js"><link rel="prefetch" href="/vuepressblog/assets/js/59.5597b93a.js"><link rel="prefetch" href="/vuepressblog/assets/js/6.ea6c0cee.js"><link rel="prefetch" href="/vuepressblog/assets/js/60.e8d7990b.js"><link rel="prefetch" href="/vuepressblog/assets/js/61.6424c560.js"><link rel="prefetch" href="/vuepressblog/assets/js/62.b9992f64.js"><link rel="prefetch" href="/vuepressblog/assets/js/63.e5e5047d.js"><link rel="prefetch" href="/vuepressblog/assets/js/64.92bdb14d.js"><link rel="prefetch" href="/vuepressblog/assets/js/65.64b742b4.js"><link rel="prefetch" href="/vuepressblog/assets/js/66.4137519f.js"><link rel="prefetch" href="/vuepressblog/assets/js/68.2e0f2b43.js"><link rel="prefetch" href="/vuepressblog/assets/js/69.87edd266.js"><link rel="prefetch" href="/vuepressblog/assets/js/7.4261eb8e.js"><link rel="prefetch" href="/vuepressblog/assets/js/70.cd211cd3.js"><link rel="prefetch" href="/vuepressblog/assets/js/71.01550a98.js"><link rel="prefetch" href="/vuepressblog/assets/js/72.89854c33.js"><link rel="prefetch" href="/vuepressblog/assets/js/73.3db2909c.js"><link rel="prefetch" href="/vuepressblog/assets/js/74.045cbd5b.js"><link rel="prefetch" href="/vuepressblog/assets/js/75.3dc91359.js"><link rel="prefetch" href="/vuepressblog/assets/js/76.8246b17d.js"><link rel="prefetch" href="/vuepressblog/assets/js/77.09f8ed6c.js"><link rel="prefetch" href="/vuepressblog/assets/js/78.c3d3e2c7.js"><link rel="prefetch" href="/vuepressblog/assets/js/79.9eea6f7c.js"><link rel="prefetch" href="/vuepressblog/assets/js/8.122aaa3d.js"><link rel="prefetch" href="/vuepressblog/assets/js/80.cfabbb82.js"><link rel="prefetch" href="/vuepressblog/assets/js/81.af4a5be4.js"><link rel="prefetch" href="/vuepressblog/assets/js/9.c86e9608.js">
    <link rel="stylesheet" href="/vuepressblog/assets/css/0.styles.984cdcb9.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepressblog/" class="home-link router-link-active"><img src="/vuepressblog/img/favicon-32x32.png" alt="IMAGINE'S BLOG" class="logo"> <span class="site-name can-hide">IMAGINE'S BLOG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepressblog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端乱炖" class="dropdown-title"><a href="/vuepressblog/web/" class="link-title">前端乱炖</a> <span class="title" style="display:none;">前端乱炖</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>原生JS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressblog/pages/048e07/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>前端框架扩展</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressblog/note/vue/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/vuepressblog/note/react/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/vuepressblog/note/ui/" class="nav-link">UI组件库</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面杂谈" class="dropdown-title"><a href="/vuepressblog/ui/" class="link-title">页面杂谈</a> <span class="title" style="display:none;">页面杂谈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressblog/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/vuepressblog/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><a href="/vuepressblog/computer/" class="link-title">计算机基础</a> <span class="title" style="display:none;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressblog/pages/browser/" class="nav-link">浏览器</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/vuepressblog/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressblog/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/vuepressblog/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/vuepressblog/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/vuepressblog/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressblog/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/vuepressblog/pages/4c778760be26d8b3/" class="nav-link">GitHub相关</a></li><li class="dropdown-item"><!----> <a href="/vuepressblog/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li></ul></div></div><div class="nav-item"><a href="/vuepressblog/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/vuepressblog/pages/beb6c0bd8a66cea6/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressblog/pages/beb6c0bd8a66cea6/" class="nav-link">网站</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/vuepressblog/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressblog/friends/" class="nav-link">友情链接</a></li></ul></div></div> <a href="https://github.com/lp-Imagine" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://i0.imgs.ovh/2024/03/24/guGRv.jpeg"> <div class="blogger-info"><h3>peng</h3> <span>平平无奇的web前端开发一枚</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/vuepressblog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端乱炖" class="dropdown-title"><a href="/vuepressblog/web/" class="link-title">前端乱炖</a> <span class="title" style="display:none;">前端乱炖</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>原生JS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressblog/pages/048e07/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>前端框架扩展</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressblog/note/vue/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/vuepressblog/note/react/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/vuepressblog/note/ui/" class="nav-link">UI组件库</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面杂谈" class="dropdown-title"><a href="/vuepressblog/ui/" class="link-title">页面杂谈</a> <span class="title" style="display:none;">页面杂谈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressblog/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/vuepressblog/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><a href="/vuepressblog/computer/" class="link-title">计算机基础</a> <span class="title" style="display:none;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressblog/pages/browser/" class="nav-link">浏览器</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/vuepressblog/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressblog/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/vuepressblog/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/vuepressblog/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/vuepressblog/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressblog/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/vuepressblog/pages/4c778760be26d8b3/" class="nav-link">GitHub相关</a></li><li class="dropdown-item"><!----> <a href="/vuepressblog/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li></ul></div></div><div class="nav-item"><a href="/vuepressblog/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/vuepressblog/pages/beb6c0bd8a66cea6/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressblog/pages/beb6c0bd8a66cea6/" class="nav-link">网站</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/vuepressblog/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressblog/friends/" class="nav-link">友情链接</a></li></ul></div></div> <a href="https://github.com/lp-Imagine" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <div class="sidebar-slot sidebar-slot-top"><!--  固定100% * 150px可显示，max-height:150px 未见显示-->
    <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:150px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>浏览器</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepressblog/pages/browser/" class="sidebar-link">浏览器渲染过程简介</a></li><li><a href="/vuepressblog/pages/1e7754/" aria-current="page" class="active sidebar-link">Chrome Extension（扩展程序）开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/vuepressblog/pages/1e7754/#基本概念" class="sidebar-link">基本概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#chrome-扩展是什么" class="sidebar-link">chrome 扩展是什么？</a></li><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#chrome-扩展用处" class="sidebar-link">chrome 扩展用处</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/vuepressblog/pages/1e7754/#开发与调试" class="sidebar-link">开发与调试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#核心结构" class="sidebar-link">核心结构</a></li><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#展现形式" class="sidebar-link">展现形式</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/vuepressblog/pages/1e7754/#五类-js-文件区别" class="sidebar-link">五类 JS 文件区别</a></li><li class="sidebar-sub-header level2"><a href="/vuepressblog/pages/1e7754/#消息通信" class="sidebar-link">消息通信</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#通信方式概览" class="sidebar-link">通信方式概览</a></li><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#popup-background" class="sidebar-link">popup&amp;&amp;background</a></li><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#popup-background-content-script" class="sidebar-link">(popup/background)&amp;&amp;content-script</a></li><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#content-script-background-popup" class="sidebar-link">content-script&amp;&amp;(background/popup)</a></li><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#inject-script-content-script" class="sidebar-link">inject-script&amp;&amp;content-script</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/vuepressblog/pages/1e7754/#补充" class="sidebar-link">补充</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#动态注入-js、css" class="sidebar-link">动态注入 JS、CSS</a></li><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#获取当前窗口-id" class="sidebar-link">获取当前窗口 ID</a></li><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#获取当前标签页-id" class="sidebar-link">获取当前标签页 ID</a></li><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#本地存储" class="sidebar-link">本地存储</a></li><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#webrequest" class="sidebar-link">webRequest</a></li><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#国际化" class="sidebar-link">国际化</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/vuepressblog/pages/1e7754/#常见的-api" class="sidebar-link">常见的 API</a></li><li class="sidebar-sub-header level2"><a href="/vuepressblog/pages/1e7754/#踩坑" class="sidebar-link">踩坑</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#查看已安装插件路径" class="sidebar-link">查看已安装插件路径</a></li><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#background-的报错" class="sidebar-link">background 的报错</a></li><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#如何让-popup-页面不关闭" class="sidebar-link">如何让 popup 页面不关闭</a></li><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#不支持内联-javascript-的执行" class="sidebar-link">不支持内联 JavaScript 的执行</a></li><li class="sidebar-sub-header level3"><a href="/vuepressblog/pages/1e7754/#注入-css" class="sidebar-link">注入 CSS</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/vuepressblog/pages/1e7754/#相关资料" class="sidebar-link">相关资料：</a></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/vuepressblog/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/vuepressblog/categories/?category=%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80" title="分类" data-v-06225672>计算机基础</a></li><li data-v-06225672><a href="/vuepressblog/categories/?category=%E6%B5%8F%E8%A7%88%E5%99%A8" title="分类" data-v-06225672>浏览器</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/lp-Imagine" target="_blank" title="作者" class="beLink" data-v-06225672>peng</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-09-06</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Chrome Extension（扩展程序）开发<!----></h1>  <div class="theme-vdoing-content content__default"><h2 id="基本概念"><a href="#基本概念" class="header-anchor">#</a> 基本概念</h2> <h3 id="chrome-扩展是什么"><a href="#chrome-扩展是什么" class="header-anchor">#</a> chrome 扩展是什么？</h3> <p>一个应用（扩展）其实是压缩（<code>.crx</code> 后缀）在一起的一组文件，包括 <code>HTML，CSS，Javascript</code> 脚本，图片文件，还有其它任何需要的文件。 应用（扩展）本质上来说就是 <code>web</code> 页面，它们可以使用所有的浏览器提供的 <code>API</code>，从 <code>XMLHttpRequest</code> 到 <code>JSON</code> 到 <code>HTML5</code> 全都有。</p> <p>应用（扩展）可以与 <code>Web</code> 页面交互，或者通过 <code>content script</code> 或 <code>cross-origin XMLHttpRequests</code> 与服务器交互。应用（扩展）还可以访问浏览器提供的内部功能，例如标签或书签等。</p> <h3 id="chrome-扩展用处"><a href="#chrome-扩展用处" class="header-anchor">#</a> chrome 扩展用处</h3> <p>增强浏览器的功能，可以向页面注入 <code>js</code> 脚本作一些操作，实现属于自己的“定制版”浏览器。
提供了很多 <code>API</code> 供我们来使用：</p> <ul><li><a href="http://open.chrome.360.cn/extension_dev/tabs.html" target="_blank" rel="noopener noreferrer">标签<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://open.chrome.360.cn/extension_dev/bookmarks.html" target="_blank" rel="noopener noreferrer">书签<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://open.chrome.360.cn/extension_dev/cookies.html" target="_blank" rel="noopener noreferrer">Cookies<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://open.chrome.360.cn/extension_dev/evnets.html" target="_blank" rel="noopener noreferrer">Events<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://open.chrome.360.cn/extension_dev/devtools.html" target="_blank" rel="noopener noreferrer">开发者工具<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://open.chrome.360.cn/extension_dev/history.html" target="_blank" rel="noopener noreferrer">历史记录<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://open.chrome.360.cn/extension_dev/management.html" target="_blank" rel="noopener noreferrer">插件管理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://open.chrome.360.cn/extension_dev/windows.html" target="_blank" rel="noopener noreferrer">视窗<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
等等...</li></ul> <hr> <h2 id="开发与调试"><a href="#开发与调试" class="header-anchor">#</a> 开发与调试</h2> <p><code>Chrome</code> 插件没有严格的项目结构要求，只要保证本目录有一个 <code>manifest.json</code> 即可，也不需要专门的 <code>IDE</code>，普通的 <code>web</code> 开发工具即可。
从右上角菜单-&gt;更多工具-&gt;扩展程序可以进入插件管理页面，也可以直接在地址栏输入 <code>chrome://extensions</code> 访问。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>勾选开发者模式即可以文件夹的形式直接加载插件，否则只能安装<code>.crx</code> 格式的文件。<code>Chrome</code> 要求插件必须从它的 <code>Chrome</code> 应用商店安装，其它任何网站下载的都无法直接安装，所以，其实我们可以把 <code>crx</code> 文件解压，然后通过开发者模式直接加载。</p> <p>开发中，代码有任何改动都必须重新加载插件，只需要在插件管理页按下 <code>Ctrl+R</code> 即可，以防万一最好还把页面刷新一下。</p></div> <h3 id="核心结构"><a href="#核心结构" class="header-anchor">#</a> 核心结构</h3> <blockquote><p><code>manifest.json</code>：这是一个 <code>Chrome</code> 插件最重要也是必不可少的文件，用来配置所有和插件相关的配置，必须放在根目录。
字段说明：</p></blockquote> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;manifest_version&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 清单文件的版本，这个必须写，而且必须是2</span>

  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;demo&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 插件的名称</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 插件的版本</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Chrome扩展demo&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 插件描述</span>
  <span class="token comment">// 图标，一般偷懒全部用一个尺寸的也没问题</span>
  <span class="token property">&quot;icons&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;16&quot;</span><span class="token operator">:</span> <span class="token string">&quot;img/icon.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;48&quot;</span><span class="token operator">:</span> <span class="token string">&quot;img/icon.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;128&quot;</span><span class="token operator">:</span> <span class="token string">&quot;img/icon.png&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 会一直常驻的后台JS或后台页面</span>
  <span class="token property">&quot;background&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 2种指定方式，如果指定JS，那么会自动生成一个背景页</span>
    <span class="token property">&quot;page&quot;</span><span class="token operator">:</span> <span class="token string">&quot;background.html&quot;</span> <span class="token comment">//&quot;scripts&quot;: [&quot;js/background.js&quot;]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 浏览器右上角图标设置，browser_action、page_action、app必须三选一</span>
  <span class="token property">&quot;browser_action&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;default_icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;img/icon.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;default_title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;这是一个Chrome插件&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 图标悬停时的标题，可选</span>
    <span class="token property">&quot;default_popup&quot;</span><span class="token operator">:</span> <span class="token string">&quot;popup.html&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/*&quot;page_action&quot;: 
 {
  &quot;default_icon&quot;: &quot;img/icon.png&quot;, // 当某些特定页面打开才显示的图标
  &quot;default_title&quot;: &quot;我是pageAction&quot;,
  &quot;default_popup&quot;: &quot;popup.html&quot;
 },*/</span> <span class="token comment">// 需要直接注入页面的JS</span>
  <span class="token property">&quot;content_scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token comment">//&quot;matches&quot;: [&quot;http://*/*&quot;, &quot;https://*/*&quot;],</span>
      <span class="token comment">// &quot;&lt;all_urls&gt;&quot; 表示匹配所有地址</span>
      <span class="token property">&quot;matches&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;all_urls&gt;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 多个JS按顺序注入</span>
      <span class="token property">&quot;js&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;js/jquery-1.8.3.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;js/content-script.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// JS的注入可以随便一点，但是CSS的注意就要千万小心了，因为一不小心就可能影响全局样式</span>
      <span class="token property">&quot;css&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;css/custom.css&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 代码注入的时间，可选值： &quot;document_start&quot;, &quot;document_end&quot;, or &quot;document_idle&quot;，最后一个表示页面空闲时，默认document_idle</span>
      <span class="token property">&quot;run_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;document_start&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 这里仅仅是为了演示content-script可以配置多个规则</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;matches&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*://*/*.png&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*://*/*.jpg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*://*/*.gif&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*://*/*.bmp&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;js&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;js/show-image-content-size.js&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 权限申请</span>
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;contextMenus&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 右键菜单</span>
    <span class="token string">&quot;tabs&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 标签</span>
    <span class="token string">&quot;notifications&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 通知</span>
    <span class="token string">&quot;webRequest&quot;</span><span class="token punctuation">,</span> <span class="token comment">// web请求</span>
    <span class="token string">&quot;webRequestBlocking&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;storage&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 插件本地存储</span>
    <span class="token string">&quot;http://*/*&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 可以通过executeScript或者insertCSS访问的网站</span>
    <span class="token string">&quot;https://*/*&quot;</span> <span class="token comment">// 可以通过executeScript或者insertCSS访问的网站</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 普通页面能够直接访问的插件资源列表，如果不设置是无法直接访问的</span>
  <span class="token property">&quot;web_accessible_resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;js/inject.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 插件主页，这个很重要，不要浪费了这个免费广告位</span>
  <span class="token property">&quot;homepage_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://www.baidu.com&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 覆盖浏览器默认页面</span>
  <span class="token property">&quot;chrome_url_overrides&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 覆盖浏览器默认的新标签页</span>
    <span class="token property">&quot;newtab&quot;</span><span class="token operator">:</span> <span class="token string">&quot;newtab.html&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// Chrome40以前的插件配置页写法</span>
  <span class="token property">&quot;options_page&quot;</span><span class="token operator">:</span> <span class="token string">&quot;options.html&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// Chrome40以后的插件配置页写法，如果2个都写，新版Chrome只认后面这一个</span>
  <span class="token property">&quot;options_ui&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;page&quot;</span><span class="token operator">:</span> <span class="token string">&quot;options.html&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;chrome_style&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 添加一些默认的样式，推荐使用</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;omnibox&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;keyword&quot;</span><span class="token operator">:</span> <span class="token string">&quot;go&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 向地址栏注册一个关键字以提供搜索建议，只能设置一个关键字</span>
  <span class="token property">&quot;default_locale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zh_CN&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 默认语言</span>
  <span class="token comment">// devtools页面入口，注意只能指向一个HTML文件，不能是JS文件</span>
  <span class="token property">&quot;devtools_page&quot;</span><span class="token operator">:</span> <span class="token string">&quot;devtools.html&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><blockquote><p><code>content-scripts</code>：是 <code>Chrome</code> 插件中向页面注入脚本的一种形式（虽然名为 <code>script</code>，其实还可以包括 <code>css</code> 的），借助 <code>content-scripts</code> 我们可以实现通过配置的方式轻松向指定页面注入 <code>JS</code> 和 <code>CSS</code>，最常见的比如：广告屏蔽、页面 <code>CSS</code> 定制，等等。</p></blockquote> <p>配置 🌰：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// 需要直接注入页面的JS</span>
  <span class="token property">&quot;content_scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token comment">//&quot;matches&quot;: [&quot;http://*/*&quot;, &quot;https://*/*&quot;],</span>
      <span class="token comment">// &quot;&lt;all_urls&gt;&quot; 表示匹配所有地址</span>
      <span class="token property">&quot;matches&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;all_urls&gt;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 多个JS按顺序注入</span>
      <span class="token property">&quot;js&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;js/jquery-1.8.3.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;js/content-script.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// JS的注入可以随便一点，但是CSS的注意就要千万小心了，因为一不小心就可能影响全局样式</span>
      <span class="token property">&quot;css&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;css/custom.css&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 代码注入的时间，可选值： &quot;document_start&quot;, &quot;document_end&quot;, or &quot;document_idle&quot;，最后一个表示页面空闲时，默认document_idle</span>
      <span class="token property">&quot;run_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;document_start&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><code>content-scripts</code> 和原始页面共享 <code>DOM</code>，但是不共享<code>JS</code>，如要访问页面 <code>JS</code>（例如某个 <code>JS</code> 变量），只能通过 <code>injected js</code> 来实现。<code>content-scripts</code> 不能访问绝大部分 <code>chrome.xxx.api</code>，除了下面这 4 种：</p> <ul><li><code>chrome.extension(getURL , inIncognitoContext , lastError , onRequest , sendRequest)</code></li> <li><code>chrome.i18n</code></li> <li><code>chrome.runtime(connect , getManifest , getURL , id , onConnect , onMessage , sendMessage)</code></li> <li><code>chrome.storage</code></li></ul> <blockquote><p><code>backgroud</code>：背景页，是一个常驻的页面，它的生命周期是插件中所有类型页面中最长的，它随着浏览器的打开而打开，随着浏览器的关闭而关闭，所以通常把需要一直运行的、启动就运行的、全局的代码放在 <code>background</code> 里面。</p></blockquote> <p><code>background</code> 的权限非常高，几乎可以调用所有的 <code>Chrome</code> 扩展 <code>API</code>（除了 <code>devtools</code>），而且它可以无限制跨域，也就是可以跨域访问任何网站而无需要求对方设置 <code>CORS</code>。不止是 <code>background</code>，所有的直接通过 <code>chrome-extension://id/xx.html</code> 这种方式打开的网页都可以无限制跨域。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// 会一直常驻的后台JS或后台页面</span>
  <span class="token property">&quot;background&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 2种指定方式，如果指定JS，那么会自动生成一个背景页</span>
    <span class="token property">&quot;page&quot;</span><span class="token operator">:</span> <span class="token string">&quot;background.html&quot;</span> <span class="token comment">//&quot;scripts&quot;: [&quot;js/background.js&quot;]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>需要特别说明的是，虽然可以通过 <code>chrome-extension://xxx/background.html</code> 直接打开后台页，但是打开的后台页和真正一直在后台运行的那个页面不是同一个，换句话说，可以打开无数个 <code>background.html</code>，但是真正在后台常驻的只有一个，而且永远看不到它的界面，只能调试它的代码。</p></div> <ul><li><code>event-pages</code>
鉴于 <code>background</code> 生命周期太长，长时间挂载后台可能会影响性能，所以 <code>Google</code> 又弄一个 <code>event-pages</code>，在配置文件上，它与 <code>background</code> 的唯一区别就是多了一个 <code>persistent</code> 参数。</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;background&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;event-page.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;persistent&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>它的生命周期是：在被需要时加载，在空闲时被关闭，什么叫被需要时呢？比如第一次安装、插件更新、有 <code>content-script</code> 向它发送消息，等等。
除了配置文件的变化，代码上也有一些细微变化，这个简单了解一下就行了，一般情况下 background 也不会很消耗性能的。</p> <blockquote><p><code>popup</code>： 是点击 <code>browser_action</code> 或者 <code>page_action</code> 图标时打开的一个小窗口网页，焦点离开网页就立即关闭，一般用来做一些临时性的交互。</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/popup.png" alt=""></p> <p><code>popup</code> 可以包含任意你想要的 <code>HTML</code> 内容，并且会自适应大小。可以通过 <code>default_popup</code> 字段来指定 <code>popup</code> 页面，也可以调用 <code>setPopup()</code>方法。
配置 🌰：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;browser_action&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;default_icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;img/icon.png&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 图标悬停时的标题，可选</span>
    <span class="token property">&quot;default_title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;这是一个Chrome插件&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;default_popup&quot;</span><span class="token operator">:</span> <span class="token string">&quot;popup.html&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>需要特别注意的是，由于单击图标打开 <code>popup</code>，焦点离开又立即关闭，所以 <code>popup</code> 页面的生命周期一般很短，需要长时间运行的代码千万不要写在 <code>popup</code> 里面。</p> <p>在权限上，它和 <code>background</code> 非常类似，它们之间最大的不同是生命周期的不同，<code>popup</code> 中可以直接通过 <code>chrome.extension.getBackgroundPage()</code>获取 <code>background</code>的 <code>window</code> 对象。</p></div> <blockquote><p><code>inject-script</code>：指的是通过 <code>DOM</code> 操作的方式向页面注入的一种 <code>JS</code>。为什么要把这种 <code>JS</code> 单独拿出来讨论呢？又或者说为什么需要通过这种方式注入 <code>JS</code> 呢？
这是因为 <code>c</code>ontent-script<code>有一个很大的“缺陷”，也就是无法访问页面中的</code>JS<code>，虽然它可以操作</code>DOM<code>，但是</code>DOM<code>却不能调用它，也就是无法在</code>DOM<code>中通过绑定事件的方式调用</code>content-script<code>中的代码（包括直接写</code>onclick<code>和</code>addEventListener<code>两种方式都不行），但是，“在页面上添加一个按钮并调用插件的扩展</code>API`”是一个很常见的需求，那该怎么办呢？其实这就是本小节要讲的。</p></blockquote> <p>在 <code>content-script</code> 中通过 <code>DOM</code> 方式向页面注入 <code>inject-script</code> 代码示例：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 向页面注入JS</span>
<span class="token keyword">function</span> <span class="token function">injectCustomJs</span><span class="token punctuation">(</span><span class="token parameter">jsPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  jsPath <span class="token operator">=</span> jsPath <span class="token operator">||</span> <span class="token string">&quot;js/inject.js&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> temp <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  temp<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/javascript&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得的地址类似：chrome-extension://ihcokhadfjfchaeagdoclpnjdiokfakg/js/inject.js</span>
  temp<span class="token punctuation">.</span>src <span class="token operator">=</span> chrome<span class="token punctuation">.</span>extension<span class="token punctuation">.</span><span class="token function">getURL</span><span class="token punctuation">(</span>jsPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
  temp<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 放在页面不好看，执行完后移除掉</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>在 <code>web</code> 中直接访问插件中的资源的话必须显示声明才行，配置文件中增加如下</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// 普通页面能够直接访问的插件资源列表，如果不设置是无法直接访问的</span>
  <span class="token property">&quot;web_accessible_resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;js/inject.js&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="展现形式"><a href="#展现形式" class="header-anchor">#</a> 展现形式</h3> <blockquote><p><code>tab browserAction</code>：通过配置 <code>browser_action</code> 可以在浏览器的右上角增加一个图标，一个 <code>browser_action</code> 可以拥有一个图标，一个 <code>tooltip</code>，一个 <code>badge</code> 和一个 <code>popup</code>。</p></blockquote> <ul><li><code>icon</code>(图标)
<code>browser_action</code>图标推荐使用宽高都为 <code>19 像素</code>的图片，更大的图标会被缩小，格式随意，一般推荐 <code>png</code>，可以通过 <code>manifest</code> 中 <code>default_icon</code> 字段配置，也可以调用 <code>setIcon()</code>方法。</li> <li><code>tooltip</code>
修改 <code>browser_action</code> 的 <code>manifest</code> 中 <code>default_title</code> 字段，或者调用 <code>setTitle()</code>方法。</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/tooltip.png" alt=""></p> <ul><li><code>badge</code>
所谓 <code>badge</code>就是在图标上显示一些文本，可以用来更新一些小的扩展状态提示信息。因为 <code>badge</code> 空间有限，所以只支持 4 个以下的字符（英文 4 个，中文 2 个）。<code>badge</code> 无法通过配置文件来指定，必须通过代码实现，设置 <code>badge</code> 文字和颜色可以分别使用 <code>setBadgeText()</code>和 <code>setBadgeBackgroundColor()</code>。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>browserAction<span class="token punctuation">.</span><span class="token function">setBadgeText</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&quot;new&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
chrome<span class="token punctuation">.</span>browserAction<span class="token punctuation">.</span><span class="token function">setBadgeBackgroundColor</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/badge.png" alt=""></p> <blockquote><p><code>pageAction</code>：所谓 pageAction，指的是只有当某些特定页面打开才显示的图标，它和 <code>browserAction</code> 最大的区别是一个始终都显示，一个只在特定情况才显示。</p></blockquote> <blockquote><p><code>右键菜单</code>：通过开发 <code>Chrome</code> 插件可以自定义浏览器的右键菜单，主要是通过 <code>chrome.contextMenusAPI</code> 实现，右键菜单可以出现在不同的上下文，比如普通页面、选中的文字、图片、链接，等等，如果有同一个插件里面定义了多个菜单，<code>Chrome</code>会自动组合放到以插件名字命名的二级菜单里，如下：</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// manifest.json</span>
<span class="token punctuation">{</span><span class="token string-property property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;contextMenus&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

<span class="token comment">// background.js</span>
chrome<span class="token punctuation">.</span>contextMenus<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
 title<span class="token operator">:</span> <span class="token string">&quot;测试右键菜单&quot;</span><span class="token punctuation">,</span>
 <span class="token function-variable function">onclick</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'您点击了右键菜单！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/click.png" alt=""></p> <blockquote><p><code>override</code>：使用 <code>override</code> 页可以将 <code>Chrome</code> 默认的一些特定页面替换掉，改为使用扩展提供的页面。
扩展可以替代如下页面：</p></blockquote> <ul><li>历史记录：从工具菜单上点击历史记录时访问的页面，或者从地址栏直接输入 <code>chrome://history</code></li> <li>新标签页：当创建新标签的时候访问的页面，或者从地址栏直接输入 <code>c</code>hrome://newtab`</li> <li>书签：浏览器的书签，或者直接输入 <code>chrome://bookmarks</code><div class="custom-block warning"><p class="custom-block-title">注意</p></div></li> <li>一个扩展只能替代一个页面；</li> <li>不能替代隐身窗口的新标签页；</li> <li>网页必须设置 <code>title</code>，否则用户可能会看到网页的 <code>URL</code>，造成困扰；
:::</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;chrome_url_overrides&quot;</span><span class="token operator">:</span>
<span class="token punctuation">{</span>
 <span class="token property">&quot;newtab&quot;</span><span class="token operator">:</span> <span class="token string">&quot;newtab.html&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;history&quot;</span><span class="token operator">:</span> <span class="token string">&quot;history.html&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;bookmarks&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bookmarks.html&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/override.png" alt=""></p> <blockquote><p><code>devtools</code>：<code>Chrome</code> 允许插件在开发者工具(<code>devtools</code>)上动手脚，主要表现在：</p></blockquote> <ul><li><p>自定义一个和多个和 <code>Elements、Console、Sources</code> 等同级别的面板；</p></li> <li><p>自定义侧边栏(<code>sidebar</code>)，目前只能自定义 <code>Elements</code> 面板的侧边栏；</p></li> <li><p><code>devtools</code> 扩展介绍
<img src="https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/vue.png" alt=""> <img src="https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/devtools.png" alt=""></p></li> <li><p>每打开一个开发者工具窗口，都会创建 <code>devtools</code> 页面的实例，<code>F12</code> 窗口关闭，页面也随着关闭，所以 <code>devtools</code> 页面的生命周期和 <code>devtools</code> 窗口是一致的。<code>devtools</code> 页面可以访问一组特有的 <code>DevTools API</code> 以及有限的扩展 <code>API</code>，这组特有的 <code>DevTools API</code> 只有 <code>devtools</code> 页面才可以访问，<code>background</code> 都无权访问，这些 <code>API</code> 包括：</p></li> <li><p><code>chrome.devtools.panels</code>：面板相关；</p></li> <li><p><code>chrome.devtools.inspectedWindow</code>：获取被审查窗口的有关信息；</p></li> <li><p><code>chrome.devtools.network</code>：获取有关网络请求的信息；
<code>options</code> 页，就是插件的设置页面，有 2 个入口，一个是右键图标有一个“选项”菜单，还有一个在插件管理页面：</p> <blockquote><p>大部分扩展 <code>API</code> 都无法直接被 <code>DevTools</code> 页面调用，但它可以像 <code>content-script</code> 一样直接调用 <code>chrome.extension</code> 和 <code>chrome.runtimeAPI</code>，同时它也可以像 <code>content-script</code> 一样使用 <code>Message</code> 交互的方式与 <code>background</code> 页面进行通信。</p></blockquote></li></ul> <blockquote><p><code>option</code>：</p></blockquote> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;options_ui&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;page&quot;</span><span class="token operator">:</span> <span class="token string">&quot;options.html&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 添加一些默认的样式，推荐使用</span>
    <span class="token property">&quot;chrome_style&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/option.png" alt=""></p> <p><img src="https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/option1.png" alt=""></p> <blockquote><p><code>omnibox</code>： 是向用户提供搜索建议的一种方式。</p></blockquote> <blockquote><p><code>omnibox</code> 应用程序界面允许向 <code>Google Chrome</code> 的地址栏注册一个关键字，地址栏也叫 <code>omnibox</code>。
当用户输入你的扩展关键字，用户开始与你的扩展交互。每个击键都会发送给你的扩展，扩展提供建议作为相应的响应。
建议可以被格式化多种方式。当用户接受建议，你的扩展被通知可以执行动作。</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/go.gif" alt=""></p> <blockquote><p>配置字段：</p></blockquote> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// 向地址栏注册一个关键字以提供搜索建议，只能设置一个关键字</span>
  <span class="token property">&quot;omnibox&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;keyword&quot;</span><span class="token operator">:</span> <span class="token string">&quot;go&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在 <code>background.js</code> 注册监听事件：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>omnibox<span class="token punctuation">.</span>onInputChanged<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> suggest</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;inputChanged: &quot;</span> <span class="token operator">+</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>text<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>text <span class="token operator">==</span> <span class="token string">&quot;微博&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">suggest</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&quot;新浪&quot;</span> <span class="token operator">+</span> text<span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&quot;新浪&quot;</span> <span class="token operator">+</span> text <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&quot;腾讯&quot;</span> <span class="token operator">+</span> text<span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&quot;腾讯&quot;</span> <span class="token operator">+</span> text <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&quot;搜狐&quot;</span> <span class="token operator">+</span> text<span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&quot;搜索&quot;</span> <span class="token operator">+</span> text <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">suggest</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&quot;百度搜索 &quot;</span> <span class="token operator">+</span> text<span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&quot;百度搜索 &quot;</span> <span class="token operator">+</span> text <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&quot;谷歌搜索 &quot;</span> <span class="token operator">+</span> text<span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&quot;谷歌搜索 &quot;</span> <span class="token operator">+</span> text <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 当用户接收关键字建议时触发</span>
chrome<span class="token punctuation">.</span>omnibox<span class="token punctuation">.</span>onInputEntered<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;inputEntered: &quot;</span> <span class="token operator">+</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>text<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> href <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&quot;微博&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    href <span class="token operator">=</span>
      <span class="token string">&quot;http://image.baidu.com/search/index?tn=baiduimage&amp;ie=utf-8&amp;word=&quot;</span> <span class="token operator">+</span> text<span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;百度搜索&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    href <span class="token operator">=</span>
      <span class="token string">&quot;https://www.baidu.com/s?ie=UTF-8&amp;wd=&quot;</span> <span class="token operator">+</span> text<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;百度搜索 &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;谷歌搜索&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    href <span class="token operator">=</span>
      <span class="token string">&quot;https://www.google.com.tw/search?q=&quot;</span> <span class="token operator">+</span> text<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;谷歌搜索 &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> href <span class="token operator">=</span> <span class="token string">&quot;https://www.baidu.com/s?ie=UTF-8&amp;wd=&quot;</span> <span class="token operator">+</span> text<span class="token punctuation">;</span>
  <span class="token function">openUrlCurrentTab</span><span class="token punctuation">(</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取当前选项卡ID</span>
<span class="token keyword">function</span> <span class="token function">getCurrentTabId</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">active</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">currentWindow</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tabs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token function">callback</span><span class="token punctuation">(</span>tabs<span class="token punctuation">.</span>length <span class="token operator">?</span> tabs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 当前标签打开某个链接</span>
<span class="token keyword">function</span> <span class="token function">openUrlCurrentTab</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">getCurrentTabId</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">tabId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>tabId<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">url</span><span class="token operator">:</span> url <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><blockquote><p><code>notification</code>：通知用户发生了一些重要的事情。桌面通知会显示在浏览器窗口之外。
<code>Chrome</code> 提供了一个 <code>chrome.notificationsAPI</code> 以便插件推送桌面通知，暂未找到 <code>chrome.notifications</code> 和 <code>HTML5</code> 自带的 <code>Notification</code> 的显著区别及优势。</p></blockquote> <p>在后台 <code>JS</code> 中，无论是使用 <code>chrome.notifications</code> 还是 <code>Notification</code> 都不需要申请权限（<code>HTML5</code> 方式需要申请权限），直接使用即可。</p> <h2 id="五类-js-文件区别"><a href="#五类-js-文件区别" class="header-anchor">#</a> 五类 JS 文件区别</h2> <table><thead><tr><th>js 类型</th> <th>可访问的 API</th> <th>DOM 访问情况</th> <th>js 访问情况</th> <th>跨域</th> <th>调试方式</th></tr></thead> <tbody><tr><td>content script</td> <td>只能访问 extension、runtime 等部分 API</td> <td>✔</td> <td>×</td> <td>×</td> <td>打开 Console,如图切换<img src="https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/tiaoshi.png" alt="tiaoshi.png"></td></tr> <tr><td>popup js</td> <td>可访问绝大部分 API，除了 devtools 系列</td> <td>不可以直接访问</td> <td>×</td> <td>✔</td> <td>popup 页面右键选择“审查弹出内容”</td></tr> <tr><td>background js</td> <td>可访问绝大部分 API，除了 devtools 系列</td> <td>不可以直接访问</td> <td>×</td> <td>✔</td> <td>插件管理页面点击背景页<img src="https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/background.png" alt="background.png"></td></tr> <tr><td>devtools js</td> <td>只能访问 devtools、extension、runtime 等部分 API</td> <td>✔</td> <td>✔</td> <td>×</td> <td>暂时没有找到有效的调试方法</td></tr> <tr><td>injected script</td> <td>和普通 JS 无任何差别，不能访问任何扩展 API</td> <td>✔</td> <td>✔</td> <td>×</td> <td>直接普通的 F12 即可</td></tr></tbody></table> <hr> <h2 id="消息通信"><a href="#消息通信" class="header-anchor">#</a> 消息通信</h2> <h3 id="通信方式概览"><a href="#通信方式概览" class="header-anchor">#</a> 通信方式概览</h3> <table><thead><tr><th>-</th> <th>injected-script</th> <th>content-script</th> <th>popup-js</th> <th>background-js</th></tr></thead> <tbody><tr><td>injected-script</td> <td>--</td> <td>window.postMessage</td> <td>--</td> <td>--</td></tr> <tr><td>content-script</td> <td>window.postMessage</td> <td>--</td> <td>chrome.runtime.sendMessage chrome.runtime.connect</td> <td>chrome.runtime.sendMessage chrome.runtime.connect</td></tr> <tr><td>popup-js</td> <td>--</td> <td>chrome.tabs.sendMessage chrome.tabs.connect</td> <td>--</td> <td>chrome.extension.getBackgroundPage()</td></tr> <tr><td>background-js</td> <td>--</td> <td>chrome.tabs.sendMessage chrome.tabs.connect</td> <td>chrome.extension.getViews</td> <td>--</td></tr> <tr><td>devtools-js</td> <td>chrome.devtools. inspectedWindow.eval</td> <td>--</td> <td>chrome.runtime.sendMessage</td> <td>chrome.runtime.sendMessage</td></tr></tbody></table> <h3 id="popup-background"><a href="#popup-background" class="header-anchor">#</a> popup&amp;&amp;background</h3> <ul><li><code>popup</code> 访问 <code>background</code> <blockquote><p><code>popup</code> 可以直接调用 <code>background</code> 的 JS 方法，并且可以直接访问 <code>background</code> 的 DOM</p></blockquote></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// background.js</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;我是background！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// popup.js</span>
<span class="token keyword">var</span> bg <span class="token operator">=</span> chrome<span class="token punctuation">.</span>extension<span class="token punctuation">.</span><span class="token function">getBackgroundPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 访问bg的函数</span>
<span class="token function">alert</span><span class="token punctuation">(</span>bg<span class="token punctuation">.</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 访问bg的DOM</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li><code>background</code> 访问 <code>popup</code><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>前提是 <code>popup</code> 已经打开时</p></div></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> views <span class="token operator">=</span> chrome<span class="token punctuation">.</span>extension<span class="token punctuation">.</span><span class="token function">getViews</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;popup&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>views<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>views<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="popup-background-content-script"><a href="#popup-background-content-script" class="header-anchor">#</a> (popup/background)&amp;&amp;content-script</h3> <ul><li><code>popup.js/background.js</code></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sendMessageToContentScript</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">active</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">currentWindow</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tabs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>tabs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token function">callback</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">sendMessageToContentScript</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">cmd</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;你好，我是popup！&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;来自content的回复：&quot;</span> <span class="token operator">+</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li><code>content-script</code> 接收消息</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> sendResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(sender.tab ?&quot;from a content script:&quot; + sender.tab.url :&quot;from the extension&quot;);</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>cmd <span class="token operator">==</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span> <span class="token function">alert</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sendResponse</span><span class="token punctuation">(</span><span class="token string">&quot;我收到了你的消息！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>双方通信直接发送的都是 <code>JSON</code> 对象，不是 <code>JSON</code> 字符串，所以无需解析，很方便（当然也可以直接发送字符串）。</p></blockquote> <h3 id="content-script-background-popup"><a href="#content-script-background-popup" class="header-anchor">#</a> content-script&amp;&amp;(background/popup)</h3> <ul><li><code>content-script.js</code></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">greeting</span><span class="token operator">:</span> <span class="token string">&quot;你好，我是content-script，主动发消息给后台！&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;收到来自后台的回复：&quot;</span> <span class="token operator">+</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>background.js/popup.js</code> 接收消息</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 监听来自content-script的消息</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> sendResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;收到来自content-script的消息：&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> sendResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sendResponse</span><span class="token punctuation">(</span><span class="token string">&quot;我是后台，我已收到你的消息：&quot;</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <ul><li><code>content_script</code> 向 <code>popup</code> 主动发消息的前提是 <code>popup</code> 必须打开！否则需要利用 <code>background</code> 作中转。</li> <li>如果 <code>background</code> 和 <code>popup</code> 同时监听，那么它们都可以同时收到消息，但是只有一个可以 <code>sendResponse</code>，一个先发送了，那么另外一个再发送就无效。</li></ul></div> <h3 id="inject-script-content-script"><a href="#inject-script-content-script" class="header-anchor">#</a> inject-script&amp;&amp;content-script</h3> <p><code>content-script</code> 和页面内的脚本（<code>injected-script</code> 自然也属于页面内的脚本）之间唯一共享的东西就是页面的 DOM 元素，有 2 种方法可以实现二者通讯：</p> <ul><li>1.可以通过 <code>window.postMessage</code> 和 <code>window.addEventListener</code> 来实现二者消息通讯(推荐)</li> <li><code>inject-script</code>:</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token string">&quot;Hello,Content&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>content-script</code>:</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>2.通过自定义 DOM 事件来实现</li> <li><code>inject-script</code>:</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> customEvent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">&quot;Event&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
customEvent<span class="token punctuation">.</span><span class="token function">initEvent</span><span class="token punctuation">(</span><span class="token string">&quot;myCustomEvent&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">fireCustomEvent</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  hiddenDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;myCustomEventDiv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  hiddenDiv<span class="token punctuation">.</span>innerText <span class="token operator">=</span> data<span class="token punctuation">;</span>
  hiddenDiv<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>customEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">fireCustomEvent</span><span class="token punctuation">(</span><span class="token string">&quot;Hello! I’m Injected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><code>content-script</code>:</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> hiddenDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;myCustomEventDiv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hiddenDiv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  hiddenDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  hiddenDiv<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>hiddenDiv<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
hiddenDiv<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;myCustomEvent&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> eventData <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;myCustomEventDiv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;收到自定义事件消息：&quot;</span> <span class="token operator">+</span> eventData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><hr> <h2 id="补充"><a href="#补充" class="header-anchor">#</a> 补充</h2> <h3 id="动态注入-js、css"><a href="#动态注入-js、css" class="header-anchor">#</a> 动态注入 JS、CSS</h3> <blockquote><p>虽然在 <code>background</code> 和 <code>popup</code> 中无法直接访问页面 DOM，但是可以通过 <code>chrome.tabs.executeScript</code> 来执行脚本，从而实现访问 web 页面的 DOM（注意，这种方式也不能直接访问页面 JS）。</p></blockquote> <p><code>manifest.json</code> 配置 🌰：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
 <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;动态注入JS/CSS&quot;</span><span class="token punctuation">,</span>
 ...
 <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;tabs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://*/*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;https://*/*&quot;</span>
 <span class="token punctuation">]</span><span class="token punctuation">,</span>
 ...
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 动态执行JS代码</span>
chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">executeScript</span><span class="token punctuation">(</span>tabId<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token string">'document.body.style.backgroundColor=&quot;red&quot;'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 动态执行JS文件</span>
chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">executeScript</span><span class="token punctuation">(</span>tabId<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">&quot;some-script.js&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 动态执行CSS代码</span>
chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">insertCSS</span><span class="token punctuation">(</span>tabId<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token string">&quot;xxx&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 动态执行CSS文件</span>
chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">insertCSS</span><span class="token punctuation">(</span>tabId<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">&quot;some-style.css&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="获取当前窗口-id"><a href="#获取当前窗口-id" class="header-anchor">#</a> 获取当前窗口 ID</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>windows<span class="token punctuation">.</span><span class="token function">getCurrent</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">currentWindow</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;当前窗口ID：&quot;</span> <span class="token operator">+</span> currentWindow<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="获取当前标签页-id"><a href="#获取当前标签页-id" class="header-anchor">#</a> 获取当前标签页 ID</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 获取当前选项卡ID</span>
<span class="token keyword">function</span> <span class="token function">getCurrentTabId</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">active</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">currentWindow</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tabs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token function">callback</span><span class="token punctuation">(</span>tabs<span class="token punctuation">.</span>length <span class="token operator">?</span> tabs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="本地存储"><a href="#本地存储" class="header-anchor">#</a> 本地存储</h3> <p>本地存储建议用 <code>chrome.storage</code> 而不是普通的 <code>localStorage</code>，区别有好几点，最重要的 2 点区别是：</p> <ul><li><code>chrome.storage</code> 是针对插件全局的，即使你在 <code>background</code> 中保存的数据，在 <code>content-script</code> 也能获取到。</li> <li><code>chrome.storage.sync</code> 可以跟随当前登录用户自动同步，这台电脑修改的设置会自动同步到其它电脑，很方便，如果没有登录或者未联网则先保存到本地，等登录了再同步至网络。</li></ul> <blockquote><p>需要声明 <code>storage</code> 权限，有 <code>chrome.storage.sync</code> 和 <code>chrome.storage.local</code>2 种方式可供选择，使用示例 🌰 如下：</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 读取数据，第一个参数是指定要读取的key以及设置默认值</span>
chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>sync<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">items</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>items<span class="token punctuation">.</span>color<span class="token punctuation">,</span> items<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 保存数据</span>
chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>sync<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;blue&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;保存成功！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="webrequest"><a href="#webrequest" class="header-anchor">#</a> webRequest</h3> <p>通过 <code>webRequest</code> 系列 API 可以对 HTTP 请求进行任性地修改、定制。
生命周期图：</p> <p><img src="https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/webRequest.png" alt=""></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//manifest.json</span>
<span class="token punctuation">{</span>
 <span class="token comment">// 权限申请</span>
 <span class="token string">&quot;permissions&quot;</span><span class="token operator">:</span>
 <span class="token punctuation">[</span>
  <span class="token string">&quot;webRequest&quot;</span><span class="token punctuation">,</span> <span class="token comment">// web请求</span>
  <span class="token string">&quot;webRequestBlocking&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 阻塞式web请求</span>
  <span class="token string">&quot;storage&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 插件本地存储</span>
  <span class="token string">&quot;http://*/*&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 可以通过executeScript或者insertCSS访问的网站</span>
  <span class="token string">&quot;https://*/*&quot;</span> <span class="token comment">// 可以通过executeScript或者insertCSS访问的网站</span>
 <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>


<span class="token comment">// background.js</span>
<span class="token comment">// 是否显示图片</span>
<span class="token keyword">var</span> showImage<span class="token punctuation">;</span>
chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>sync<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">showImage</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">items</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 showImage <span class="token operator">=</span> items<span class="token punctuation">.</span>showImage<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// web请求监听，最后一个参数表示阻塞式，需单独声明权限：webRequestBlocking</span>
chrome<span class="token punctuation">.</span>webRequest<span class="token punctuation">.</span>onBeforeRequest<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token parameter">details</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token comment">// cancel 表示取消本次请求</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>showImage <span class="token operator">&amp;&amp;</span> details<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'image'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">cancel</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
 <span class="token comment">// 简单的音视频检测</span>
 <span class="token comment">// 大部分网站视频的type并不是media，且视频做了防下载处理，所以这里仅仅是为了演示效果，无实际意义</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'media'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  chrome<span class="token punctuation">.</span>notifications<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   type<span class="token operator">:</span> <span class="token string">'basic'</span><span class="token punctuation">,</span>
   iconUrl<span class="token operator">:</span> <span class="token string">'img/icon48.png'</span><span class="token punctuation">,</span>
   title<span class="token operator">:</span> <span class="token string">'检测到音视频'</span><span class="token punctuation">,</span>
   message<span class="token operator">:</span> <span class="token string">'音视频地址：'</span> <span class="token operator">+</span> details<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">urls</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;all_urls&gt;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;blocking&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>示例 🌰：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 每次请求前触发，可以拿到 requestBody 数据，同时可以对本次请求作出干预修改</span>
chrome<span class="token punctuation">.</span>webRequest<span class="token punctuation">.</span>onBeforeRequest<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">details</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;onBeforeRequest&quot;</span><span class="token punctuation">,</span> details<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">urls</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;all_urls&gt;&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">&quot;blocking&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;extraHeaders&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;requestBody&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 发送header之前触发，可以拿到请求headers，也可以添加、修改、删除headers</span>
<span class="token comment">// 但使用有一定限制，一些特殊头部可能拿不到或者存在特殊情况，详见官网文档</span>
chrome<span class="token punctuation">.</span>webRequest<span class="token punctuation">.</span>onBeforeSendHeaders<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">details</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;onBeforeSendHeaders&quot;</span><span class="token punctuation">,</span> details<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">urls</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;all_urls&gt;&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">&quot;blocking&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;extraHeaders&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;requestHeaders&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 开始响应触发，可以拿到服务端返回的headers</span>
chrome<span class="token punctuation">.</span>webRequest<span class="token punctuation">.</span>onResponseStarted<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">details</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;onResponseStarted&quot;</span><span class="token punctuation">,</span> details<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">urls</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;all_urls&gt;&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">&quot;extraHeaders&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;responseHeaders&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 请求完成触发，能拿到的数据和onResponseStarted一样，注意无法拿到responseBody</span>
chrome<span class="token punctuation">.</span>webRequest<span class="token punctuation">.</span>onCompleted<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">details</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;onCompleted&quot;</span><span class="token punctuation">,</span> details<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">urls</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;all_urls&gt;&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">&quot;extraHeaders&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;responseHeaders&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>上面示例中提到，使用 <code>webRequestAPI</code> 是无法拿到 <code>responseBody</code> 的，想要拿到的话只能采取一些变通方法，例如：</p> <ul><li>重写 <code>XmlHttpRequest</code> 和 <code>fetch</code>，增加自定义拦截事件，缺点是实现方式可能有点脏，重写不好的话可能影响正常页面。</li> <li><code>devtools</code> 的 <code>chrome.devtools.network.onRequestFinishedAPI</code> 可以拿到返回的 body，缺点是必须打开开发者面板。</li> <li>使用 <code>chrome.debugger.sendCommand</code> 发送 <code>Network.getResponseBody</code> 命令来获取 body 内容，缺点也很明显，会有一个恼人的提示。</li></ul> <blockquote><p>具体的实现方式可以查看<a href="https://stackoverflow.com/questions/18534771/chrome-extension-how-to-get-http-response-body" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/18534771/chrome-extension-how-to-get-http-response-body<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="国际化"><a href="#国际化" class="header-anchor">#</a> 国际化</h3> <p>插件根目录新建一个名为<code>locales</code> 的文件夹，再在下面新建一些语言的文件夹，如 <code>en、zh_CN、zh_TW</code>，然后再在每个文件夹放入一个 <code>messages.json</code>，同时必须在清单文件中设置 <code>default_locale</code>。</p> <ul><li><code>\locales\en\messages.json</code>：</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;pluginDesc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;A chrome extension demo&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;helloWorld&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hello World!&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>\locales\zh_CN\messages.json</code>:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;pluginDesc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;一个Chrome插件demo&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;helloWorld&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;你好，世界！&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>在 <code>manifest.json</code> 和 CSS 文件中通过<strong>MSG_messagename</strong>引入，如：</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;__MSG_pluginDesc__&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 默认语言</span>
  <span class="token property">&quot;default_locale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zh_CN&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>在 JS 中则直接 <code>chrome.i18n.getMessage(&quot;helloWorld&quot;)</code>。</li> <li>测试时，通过给 chrome 建立一个不同的快捷方式 <code>chrome.exe --lang=en</code> 来切换语言</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/i18n.png" alt=""></p> <h2 id="常见的-api"><a href="#常见的-api" class="header-anchor">#</a> 常见的 API</h2> <p>所有的 <code>Chrome API</code> 都是以 <code>chrome</code> 对象开头，🌰 如：<code>chrome.tabs</code></p> <ul><li><code>bookmarks</code>操纵书签的 API</li> <li><code>browserAction</code> 获取扩展图标、标题、文字、弹出页等</li> <li><code>browsingData</code>控制浏览器的浏览数据，从本地文件</li> <li><code>commands</code> 给扩展添加快捷键</li> <li><code>contextMenus</code> 添加选项到右键弹出菜单</li> <li><code>cookies</code>控制 <code>cookies</code></li> <li><code>desktopCapture</code> 捕获屏幕、个人窗口或标签内容</li> <li><code>downloads</code> 下载控制</li> <li><code>events</code> 事件相关 API</li> <li><code>extension</code> 获取扩展的各部分，也能与各部分交换信息</li> <li><code>extensionTypes</code> 扩展的类型声明</li> <li><code>gcm</code> 启用 google 云消息服务，收发消息</li> <li><code>history</code> 历史记录控制</li> <li><code>i18n</code>多语言国际化支持</li> <li><code>idle</code> 取得机器闲置状态</li> <li><code>management</code> 管理扩展与应用</li> <li><code>notifications</code> 通知控制</li> <li><code>pageAction</code> 具体的页面下控制扩展图标、标题、文字、弹出页等相关内容</li> <li><code>permissions</code> 获取拥有的权限</li> <li><code>power</code> 请求系统常亮</li> <li><code>runtime</code> 获取运行时相关信息，包括后台页、<code>manifest</code> 等等</li> <li><code>sessions</code> 查询或恢复浏览会话</li> <li><code>storage</code> 存储相关</li> <li><code>tabs</code> 与标签页交互</li> <li><code>vpnProvider</code> 实现 <code>vpn</code> 客户端需要使用的东西</li> <li><code>webRequest</code> 拦截、修改、阻塞请求</li> <li><code>windows</code> 创建、修改、重排窗口</li></ul> <h2 id="踩坑"><a href="#踩坑" class="header-anchor">#</a> 踩坑</h2> <h3 id="查看已安装插件路径"><a href="#查看已安装插件路径" class="header-anchor">#</a> 查看已安装插件路径</h3> <p>查看本地已安装的插件源码路径 <code>C:\Users\用户名\AppData\Local\Google\Chrome\User Data\Default\Extensions</code>，每一个插件被放在以插件 ID 为名的文件夹里面，想要学习某个插件的某个功能是如何实现的，看人家的源码是最好的方法了。</p> <blockquote><p><code>Mac</code> 系统插件本地缓存位于：<code>/Users/用户名/Library/Application Support/Google/Chrome/Default/Extensions</code> 文件夹</p></blockquote> <p>如何查看某个插件的 ID 进入 <code>chrome://extensions</code> ，然后勾选开发者模式即可看到了。</p> <h3 id="background-的报错"><a href="#background-的报错" class="header-anchor">#</a> background 的报错</h3> <p>很多时候你发现你的代码会莫名其妙的失效，找来找去又找不到原因，这时打开 <code>background</code> 的控制台才发现原来某个地方写错了导致代码没生效，这是由于 <code>background</code>报错的隐蔽性(需要主动打开对应的控制台才能看到错误)</p> <h3 id="如何让-popup-页面不关闭"><a href="#如何让-popup-页面不关闭" class="header-anchor">#</a> 如何让 popup 页面不关闭</h3> <p>在对 <code>popup</code> 页面审查元素的时候 <code>popup</code> 会被强制打开无法关闭，只有控制台关闭了才可以关闭 <code>popup</code>，原因很简单：如果 <code>popup</code> 关闭了控制台就没用了。这种方法在某些情况下很实用！</p> <h3 id="不支持内联-javascript-的执行"><a href="#不支持内联-javascript-的执行" class="header-anchor">#</a> 不支持内联 JavaScript 的执行</h3> <p>就是不支持将 js 直接写在 html 中，例如 🌰：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>按钮<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">handleBtn</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token punctuation">/&gt;</span></span>

// 报错 // Refused to execute inline event handler because it violates the
following Content Security Policy directive: &quot;script-src 'self' blob:
filesystem: chrome-extension-resource:&quot;. Either the 'unsafe-inline' keyword, a
hash ('sha256-...'), or a nonce ('nonce-...') is required to enable inline
execution.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>只能通过 js 绑定事件：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#btn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;测试&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>另外，对于 A 标签，这样写 <code>href=&quot;javascript:;&quot;</code>然后用 JS 绑定事件虽然控制台会报错，但是不受影响，当然强迫症患者受不了的话只能写成 <code>href=&quot;#&quot;</code>了。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:;<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>get_res<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>请求<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>

// 报错 // Refused to execute JavaScript URL because it violates the following
Content Security Policy directive: &quot;script-src 'self' blob: filesystem:
chrome-extension-resource:&quot;. Either the 'unsafe-inline' keyword, a hash
('sha256-...'), or a nonce ('nonce-...') is required to enable inline execution.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="注入-css"><a href="#注入-css" class="header-anchor">#</a> 注入 CSS</h3> <p>由于通过 <code>content_scripts</code> 注入的 CSS 优先级非常高，几乎仅次于浏览器默认样式，稍不注意可能就会影响一些网站的展示效果，所以尽量不要写一些影响全局的样式。</p> <blockquote><p>之所以强调这个，是因为这个带来的问题非常隐蔽，不太容易找到，可能你正在写某个网页，昨天样式还是好好的，怎么今天就突然不行了？然后你辛辛苦苦找来找去，找了半天才发现竟然是因为插件里面的一个样式影响的！</p></blockquote> <hr> <p>原文：<a href="http://blog.haoji.me/chrome-plugin-develop.html#dong-tai-zhu-ru-huo-zhi-xing-JS" target="_blank" rel="noopener noreferrer">http://blog.haoji.me/chrome-plugin-develop.html#dong-tai-zhu-ru-huo-zhi-xing-JS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="相关资料"><a href="#相关资料" class="header-anchor">#</a> 相关资料：</h2> <div class="cardListContainer"><div class="card-list"><a href="http://open.se.360.cn/open/extension_dev/overview.html" target="_blank" class="card-item row-2" style="background-color:#F0DFB1;--random-color:#F0DFB1;color:#242A38;"><div><p class="name">360安全浏览器开发文档（推荐）</p> <p class="desc"></p></div></a> <a href="http://open.chrome.360.cn/extension_dev/overview.html" target="_blank" class="card-item row-2" style="background-color:#DFEEE7;--random-color:#DFEEE7;color:#2A3344;"><div><p class="name">360极速浏览器Chrome扩展开发文档</p> <p class="desc"></p></div></a> <a href="https://www.cnblogs.com/champagne/p/" target="_blank" class="card-item row-2" style="background-color:#2bc2d6;--random-color:#2bc2d6;color:#2A3344;"><div><p class="name">Chrome扩展开发极客</p> <p class="desc"></p></div></a> <a href="https://developer.chrome.com/extensions" target="_blank" class="card-item row-2" style="background-color:#2bd64d;--random-color:#2bd64d;color:#2A3344;"><div><p class="name">chrome扩展开发官方文档（需要翻墙</p> <p class="desc"></p></div></a> <a href="https://developer.chrome.com/extensions/api_index" target="_blank" class="card-item row-2" style="background-color:#b8b823;--random-color:#b8b823;color:#2A3344;"><div><p class="name">chrome API支持（需要翻墙）</p> <p class="desc"></p></div></a></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 360安全浏览器开发文档（推荐）
  <span class="token key atrule">desc</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
  <span class="token key atrule">bgColor</span><span class="token punctuation">:</span> <span class="token string">&quot;#F0DFB1&quot;</span>
  <span class="token key atrule">textColor</span><span class="token punctuation">:</span> <span class="token string">&quot;#242A38&quot;</span>
  <span class="token key atrule">link</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//open.se.360.cn/open/extension_dev/overview.html
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 360极速浏览器Chrome扩展开发文档
  <span class="token key atrule">desc</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
  <span class="token key atrule">link</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//open.chrome.360.cn/extension_dev/overview.html
  <span class="token key atrule">bgColor</span><span class="token punctuation">:</span> <span class="token string">&quot;#DFEEE7&quot;</span>
  <span class="token key atrule">textColor</span><span class="token punctuation">:</span> <span class="token string">&quot;#2A3344&quot;</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Chrome扩展开发极客
  <span class="token key atrule">desc</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
  <span class="token key atrule">link</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//www.cnblogs.com/champagne/p/
  <span class="token key atrule">bgColor</span><span class="token punctuation">:</span> <span class="token string">&quot;#2bc2d6&quot;</span>
  <span class="token key atrule">textColor</span><span class="token punctuation">:</span> <span class="token string">&quot;#2A3344&quot;</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> chrome扩展开发官方文档（需要翻墙
  <span class="token key atrule">desc</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
  <span class="token key atrule">link</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//developer.chrome.com/extensions
  <span class="token key atrule">bgColor</span><span class="token punctuation">:</span> <span class="token string">&quot;#2bd64d&quot;</span>
  <span class="token key atrule">textColor</span><span class="token punctuation">:</span> <span class="token string">&quot;#2A3344&quot;</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> chrome API支持（需要翻墙）
  <span class="token key atrule">desc</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
  <span class="token key atrule">link</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//developer.chrome.com/extensions/api_index
  <span class="token key atrule">bgColor</span><span class="token punctuation">:</span> <span class="token string">&quot;#b8b823&quot;</span>
  <span class="token key atrule">textColor</span><span class="token punctuation">:</span> <span class="token string">&quot;#2A3344&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></div></div></div>  <div class="page-edit"><!----> <div class="tags"><a href="/vuepressblog/tags/?tag=Chrome" title="标签">#Chrome</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/09/06, 16:21:32</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/vuepressblog/pages/browser/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">浏览器渲染过程简介</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/vuepressblog/pages/browser/" class="prev">浏览器渲染过程简介</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/vuepressblog/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/vuepressblog/pages/b63ee9/"><div>
            Axios 封装
            <!----></div></a> <span class="date">09-06</span></dt></dl><dl><dd>02</dd> <dt><a href="/vuepressblog/pages/c28fac/"><div>
            MySQL数据库常用操作
            <!----></div></a> <span class="date">09-06</span></dt></dl><dl><dd>03</dd> <dt><a href="/vuepressblog/pages/09fc1e/"><div>
            解决element表格数据量过大导致页面渲染缓慢、卡顿问题
            <!----></div></a> <span class="date">09-06</span></dt></dl> <dl><dd></dd> <dt><a href="/vuepressblog/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:luopeng101297@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/lp-Imagine" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2020-2024
    <span>peng | <a href="https://lp-imagine.github.io/vuepressblog/" target="_blank">IMAGINE</a>
        <br/>image | <a href="https://imgloc.com/" target = "_blank" > imgloc.com </a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/vuepressblog/assets/js/app.0a5890d8.js" defer></script><script src="/vuepressblog/assets/js/2.b3d401a1.js" defer></script><script src="/vuepressblog/assets/js/67.f61ce51a.js" defer></script>
  </body>
</html>
