---
title: Chrome Extensionï¼ˆæ‰©å±•ç¨‹åºï¼‰å¼€å‘
date: 2022-09-06 15:03:39
permalink: /pages/1e7754/
categories:
  - è®¡ç®—æœºåŸºç¡€
  - æµè§ˆå™¨
tags:
  - Chrome
author:
  name: peng
  link: https://github.com/lp-Imagine
---

## åŸºæœ¬æ¦‚å¿µ

### chrome æ‰©å±•æ˜¯ä»€ä¹ˆï¼Ÿ

ä¸€ä¸ªåº”ç”¨ï¼ˆæ‰©å±•ï¼‰å…¶å®æ˜¯å‹ç¼©ï¼ˆ`.crx` åç¼€ï¼‰åœ¨ä¸€èµ·çš„ä¸€ç»„æ–‡ä»¶ï¼ŒåŒ…æ‹¬ `HTMLï¼ŒCSSï¼ŒJavascript` è„šæœ¬ï¼Œå›¾ç‰‡æ–‡ä»¶ï¼Œè¿˜æœ‰å…¶å®ƒä»»ä½•éœ€è¦çš„æ–‡ä»¶ã€‚ åº”ç”¨ï¼ˆæ‰©å±•ï¼‰æœ¬è´¨ä¸Šæ¥è¯´å°±æ˜¯ `web` é¡µé¢ï¼Œå®ƒä»¬å¯ä»¥ä½¿ç”¨æ‰€æœ‰çš„æµè§ˆå™¨æä¾›çš„ `API`ï¼Œä» `XMLHttpRequest` åˆ° `JSON` åˆ° `HTML5` å…¨éƒ½æœ‰ã€‚

åº”ç”¨ï¼ˆæ‰©å±•ï¼‰å¯ä»¥ä¸ `Web` é¡µé¢äº¤äº’ï¼Œæˆ–è€…é€šè¿‡ `content script` æˆ– `cross-origin XMLHttpRequests` ä¸æœåŠ¡å™¨äº¤äº’ã€‚åº”ç”¨ï¼ˆæ‰©å±•ï¼‰è¿˜å¯ä»¥è®¿é—®æµè§ˆå™¨æä¾›çš„å†…éƒ¨åŠŸèƒ½ï¼Œä¾‹å¦‚æ ‡ç­¾æˆ–ä¹¦ç­¾ç­‰ã€‚

<!-- more -->

### chrome æ‰©å±•ç”¨å¤„

å¢å¼ºæµè§ˆå™¨çš„åŠŸèƒ½ï¼Œå¯ä»¥å‘é¡µé¢æ³¨å…¥ `js` è„šæœ¬ä½œä¸€äº›æ“ä½œï¼Œå®ç°å±äºè‡ªå·±çš„â€œå®šåˆ¶ç‰ˆâ€æµè§ˆå™¨ã€‚
æä¾›äº†å¾ˆå¤š `API` ä¾›æˆ‘ä»¬æ¥ä½¿ç”¨ï¼š

- [æ ‡ç­¾](http://open.chrome.360.cn/extension_dev/tabs.html)
- [ä¹¦ç­¾](http://open.chrome.360.cn/extension_dev/bookmarks.html)
- [Cookies](http://open.chrome.360.cn/extension_dev/cookies.html)
- [Events](http://open.chrome.360.cn/extension_dev/evnets.html)
- [å¼€å‘è€…å·¥å…·](http://open.chrome.360.cn/extension_dev/devtools.html)
- [å†å²è®°å½•](http://open.chrome.360.cn/extension_dev/history.html)
- [æ’ä»¶ç®¡ç†](http://open.chrome.360.cn/extension_dev/management.html)
- [è§†çª—](http://open.chrome.360.cn/extension_dev/windows.html)
  ç­‰ç­‰...

---

## å¼€å‘ä¸è°ƒè¯•

`Chrome` æ’ä»¶æ²¡æœ‰ä¸¥æ ¼çš„é¡¹ç›®ç»“æ„è¦æ±‚ï¼Œåªè¦ä¿è¯æœ¬ç›®å½•æœ‰ä¸€ä¸ª `manifest.json` å³å¯ï¼Œä¹Ÿä¸éœ€è¦ä¸“é—¨çš„ `IDE`ï¼Œæ™®é€šçš„ `web` å¼€å‘å·¥å…·å³å¯ã€‚
ä»å³ä¸Šè§’èœå•->æ›´å¤šå·¥å…·->æ‰©å±•ç¨‹åºå¯ä»¥è¿›å…¥æ’ä»¶ç®¡ç†é¡µé¢ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨åœ°å€æ è¾“å…¥ `chrome://extensions` è®¿é—®ã€‚
::: tip
å‹¾é€‰å¼€å‘è€…æ¨¡å¼å³å¯ä»¥æ–‡ä»¶å¤¹çš„å½¢å¼ç›´æ¥åŠ è½½æ’ä»¶ï¼Œå¦åˆ™åªèƒ½å®‰è£…`.crx` æ ¼å¼çš„æ–‡ä»¶ã€‚`Chrome` è¦æ±‚æ’ä»¶å¿…é¡»ä»å®ƒçš„ `Chrome` åº”ç”¨å•†åº—å®‰è£…ï¼Œå…¶å®ƒä»»ä½•ç½‘ç«™ä¸‹è½½çš„éƒ½æ— æ³•ç›´æ¥å®‰è£…ï¼Œæ‰€ä»¥ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥æŠŠ `crx` æ–‡ä»¶è§£å‹ï¼Œç„¶åé€šè¿‡å¼€å‘è€…æ¨¡å¼ç›´æ¥åŠ è½½ã€‚

å¼€å‘ä¸­ï¼Œä»£ç æœ‰ä»»ä½•æ”¹åŠ¨éƒ½å¿…é¡»é‡æ–°åŠ è½½æ’ä»¶ï¼Œåªéœ€è¦åœ¨æ’ä»¶ç®¡ç†é¡µæŒ‰ä¸‹ `Ctrl+R` å³å¯ï¼Œä»¥é˜²ä¸‡ä¸€æœ€å¥½è¿˜æŠŠé¡µé¢åˆ·æ–°ä¸€ä¸‹ã€‚
:::

### æ ¸å¿ƒç»“æ„

> `manifest.json`ï¼šè¿™æ˜¯ä¸€ä¸ª `Chrome` æ’ä»¶æœ€é‡è¦ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„æ–‡ä»¶ï¼Œç”¨æ¥é…ç½®æ‰€æœ‰å’Œæ’ä»¶ç›¸å…³çš„é…ç½®ï¼Œå¿…é¡»æ”¾åœ¨æ ¹ç›®å½•ã€‚
> å­—æ®µè¯´æ˜ï¼š

```json
{
  "manifest_version": 2, //Â æ¸…å•æ–‡ä»¶çš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªå¿…é¡»å†™ï¼Œè€Œä¸”å¿…é¡»æ˜¯2

  "name": "demo", //Â æ’ä»¶çš„åç§°
  "version": "1.0.0", //Â æ’ä»¶çš„ç‰ˆæœ¬
  "description": "Chromeæ‰©å±•demo", //Â æ’ä»¶æè¿°
  //Â å›¾æ ‡ï¼Œä¸€èˆ¬å·æ‡’å…¨éƒ¨ç”¨ä¸€ä¸ªå°ºå¯¸çš„ä¹Ÿæ²¡é—®é¢˜
  "icons": {
    "16": "img/icon.png",
    "48": "img/icon.png",
    "128": "img/icon.png"
  },
  //Â ä¼šä¸€ç›´å¸¸é©»çš„åå°JSæˆ–åå°é¡µé¢
  "background": {
    //Â 2ç§æŒ‡å®šæ–¹å¼ï¼Œå¦‚æœæŒ‡å®šJSï¼Œé‚£ä¹ˆä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªèƒŒæ™¯é¡µ
    "page": "background.html" //"scripts":Â ["js/background.js"]
  },
  //Â æµè§ˆå™¨å³ä¸Šè§’å›¾æ ‡è®¾ç½®ï¼Œbrowser_actionã€page_actionã€appå¿…é¡»ä¸‰é€‰ä¸€
  "browser_action": {
    "default_icon": "img/icon.png",
    "default_title": "è¿™æ˜¯ä¸€ä¸ªChromeæ’ä»¶", //Â å›¾æ ‡æ‚¬åœæ—¶çš„æ ‡é¢˜ï¼Œå¯é€‰
    "default_popup": "popup.html"
  },
  /*"page_action": 
Â {
Â Â "default_icon":Â "img/icon.png", //Â å½“æŸäº›ç‰¹å®šé¡µé¢æ‰“å¼€æ‰æ˜¾ç¤ºçš„å›¾æ ‡
Â Â "default_title":Â "æˆ‘æ˜¯pageAction",
Â Â "default_popup":Â "popup.html"
Â },*/ //Â éœ€è¦ç›´æ¥æ³¨å…¥é¡µé¢çš„JS
  "content_scripts": [
    {
      //"matches":Â ["http://*/*",Â "https://*/*"],
      //Â "<all_urls>"Â è¡¨ç¤ºåŒ¹é…æ‰€æœ‰åœ°å€
      "matches": ["<all_urls>"], //Â å¤šä¸ªJSæŒ‰é¡ºåºæ³¨å…¥
      "js": ["js/jquery-1.8.3.js", "js/content-script.js"], //Â JSçš„æ³¨å…¥å¯ä»¥éšä¾¿ä¸€ç‚¹ï¼Œä½†æ˜¯CSSçš„æ³¨æ„å°±è¦åƒä¸‡å°å¿ƒäº†ï¼Œå› ä¸ºä¸€ä¸å°å¿ƒå°±å¯èƒ½å½±å“å…¨å±€æ ·å¼
      "css": ["css/custom.css"], //Â ä»£ç æ³¨å…¥çš„æ—¶é—´ï¼Œå¯é€‰å€¼ï¼šÂ "document_start", "document_end", or "document_idle"ï¼Œæœ€åä¸€ä¸ªè¡¨ç¤ºé¡µé¢ç©ºé—²æ—¶ï¼Œé»˜è®¤document_idle
      "run_at": "document_start"
    },
    //Â è¿™é‡Œä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºcontent-scriptå¯ä»¥é…ç½®å¤šä¸ªè§„åˆ™
    {
      "matches": ["*://*/*.png", "*://*/*.jpg", "*://*/*.gif", "*://*/*.bmp"],
      "js": ["js/show-image-content-size.js"]
    }
  ],
  //Â æƒé™ç”³è¯·
  "permissions": [
    "contextMenus", //Â å³é”®èœå•
    "tabs", //Â æ ‡ç­¾
    "notifications", //Â é€šçŸ¥
    "webRequest", //Â webè¯·æ±‚
    "webRequestBlocking",
    "storage", //Â æ’ä»¶æœ¬åœ°å­˜å‚¨
    "http://*/*", //Â å¯ä»¥é€šè¿‡executeScriptæˆ–è€…insertCSSè®¿é—®çš„ç½‘ç«™
    "https://*/*" //Â å¯ä»¥é€šè¿‡executeScriptæˆ–è€…insertCSSè®¿é—®çš„ç½‘ç«™
  ],
  //Â æ™®é€šé¡µé¢èƒ½å¤Ÿç›´æ¥è®¿é—®çš„æ’ä»¶èµ„æºåˆ—è¡¨ï¼Œå¦‚æœä¸è®¾ç½®æ˜¯æ— æ³•ç›´æ¥è®¿é—®çš„
  "web_accessible_resources": ["js/inject.js"], //Â æ’ä»¶ä¸»é¡µï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼Œä¸è¦æµªè´¹äº†è¿™ä¸ªå…è´¹å¹¿å‘Šä½
  "homepage_url": "https://www.baidu.com", //Â è¦†ç›–æµè§ˆå™¨é»˜è®¤é¡µé¢
  "chrome_url_overrides": {
    //Â è¦†ç›–æµè§ˆå™¨é»˜è®¤çš„æ–°æ ‡ç­¾é¡µ
    "newtab": "newtab.html"
  },
  //Â Chrome40ä»¥å‰çš„æ’ä»¶é…ç½®é¡µå†™æ³•
  "options_page": "options.html",
  //Â Chrome40ä»¥åçš„æ’ä»¶é…ç½®é¡µå†™æ³•ï¼Œå¦‚æœ2ä¸ªéƒ½å†™ï¼Œæ–°ç‰ˆChromeåªè®¤åé¢è¿™ä¸€ä¸ª
  "options_ui": {
    "page": "options.html",
    "chrome_style": true //Â æ·»åŠ ä¸€äº›é»˜è®¤çš„æ ·å¼ï¼Œæ¨èä½¿ç”¨
  },
  "omnibox": { "keyword": "go" }, //Â å‘åœ°å€æ æ³¨å†Œä¸€ä¸ªå…³é”®å­—ä»¥æä¾›æœç´¢å»ºè®®ï¼Œåªèƒ½è®¾ç½®ä¸€ä¸ªå…³é”®å­—
  "default_locale": "zh_CN", //Â é»˜è®¤è¯­è¨€
  //Â devtoolsé¡µé¢å…¥å£ï¼Œæ³¨æ„åªèƒ½æŒ‡å‘ä¸€ä¸ªHTMLæ–‡ä»¶ï¼Œä¸èƒ½æ˜¯JSæ–‡ä»¶
  "devtools_page": "devtools.html"
}
```

> `content-scripts`ï¼šæ˜¯ `Chrome` æ’ä»¶ä¸­å‘é¡µé¢æ³¨å…¥è„šæœ¬çš„ä¸€ç§å½¢å¼ï¼ˆè™½ç„¶åä¸º `script`ï¼Œå…¶å®è¿˜å¯ä»¥åŒ…æ‹¬ `css` çš„ï¼‰ï¼Œå€ŸåŠ© `content-scripts` æˆ‘ä»¬å¯ä»¥å®ç°é€šè¿‡é…ç½®çš„æ–¹å¼è½»æ¾å‘æŒ‡å®šé¡µé¢æ³¨å…¥ `JS` å’Œ `CSS`ï¼Œæœ€å¸¸è§çš„æ¯”å¦‚ï¼šå¹¿å‘Šå±è”½ã€é¡µé¢ `CSS` å®šåˆ¶ï¼Œç­‰ç­‰ã€‚

é…ç½® ğŸŒ°ï¼š

```json
{
  //Â éœ€è¦ç›´æ¥æ³¨å…¥é¡µé¢çš„JS
  "content_scripts": [
    {
      //"matches":Â ["http://*/*",Â "https://*/*"],
      //Â "<all_urls>"Â è¡¨ç¤ºåŒ¹é…æ‰€æœ‰åœ°å€
      "matches": ["<all_urls>"], //Â å¤šä¸ªJSæŒ‰é¡ºåºæ³¨å…¥
      "js": ["js/jquery-1.8.3.js", "js/content-script.js"], //Â JSçš„æ³¨å…¥å¯ä»¥éšä¾¿ä¸€ç‚¹ï¼Œä½†æ˜¯CSSçš„æ³¨æ„å°±è¦åƒä¸‡å°å¿ƒäº†ï¼Œå› ä¸ºä¸€ä¸å°å¿ƒå°±å¯èƒ½å½±å“å…¨å±€æ ·å¼
      "css": ["css/custom.css"], //Â ä»£ç æ³¨å…¥çš„æ—¶é—´ï¼Œå¯é€‰å€¼ï¼šÂ "document_start", "document_end", or "document_idle"ï¼Œæœ€åä¸€ä¸ªè¡¨ç¤ºé¡µé¢ç©ºé—²æ—¶ï¼Œé»˜è®¤document_idle
      "run_at": "document_start"
    }
  ]
}
```

`content-scripts` å’ŒåŸå§‹é¡µé¢å…±äº« `DOM`ï¼Œä½†æ˜¯ä¸å…±äº«`JS`ï¼Œå¦‚è¦è®¿é—®é¡µé¢ `JS`ï¼ˆä¾‹å¦‚æŸä¸ª `JS` å˜é‡ï¼‰ï¼Œåªèƒ½é€šè¿‡ `injected js` æ¥å®ç°ã€‚`content-scripts` ä¸èƒ½è®¿é—®ç»å¤§éƒ¨åˆ† `chrome.xxx.api`ï¼Œé™¤äº†ä¸‹é¢è¿™ 4 ç§ï¼š

- `chrome.extension(getURL , inIncognitoContext , lastError , onRequest , sendRequest)`
- `chrome.i18n`
- `chrome.runtime(connect , getManifest , getURL , id , onConnect , onMessage , sendMessage)`
- `chrome.storage`

> `backgroud`ï¼šèƒŒæ™¯é¡µï¼Œæ˜¯ä¸€ä¸ªå¸¸é©»çš„é¡µé¢ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ’ä»¶ä¸­æ‰€æœ‰ç±»å‹é¡µé¢ä¸­æœ€é•¿çš„ï¼Œå®ƒéšç€æµè§ˆå™¨çš„æ‰“å¼€è€Œæ‰“å¼€ï¼Œéšç€æµè§ˆå™¨çš„å…³é—­è€Œå…³é—­ï¼Œæ‰€ä»¥é€šå¸¸æŠŠéœ€è¦ä¸€ç›´è¿è¡Œçš„ã€å¯åŠ¨å°±è¿è¡Œçš„ã€å…¨å±€çš„ä»£ç æ”¾åœ¨ `background` é‡Œé¢ã€‚

`background` çš„æƒé™éå¸¸é«˜ï¼Œå‡ ä¹å¯ä»¥è°ƒç”¨æ‰€æœ‰çš„ `Chrome` æ‰©å±• `API`ï¼ˆé™¤äº† `devtools`ï¼‰ï¼Œè€Œä¸”å®ƒå¯ä»¥æ— é™åˆ¶è·¨åŸŸï¼Œä¹Ÿå°±æ˜¯å¯ä»¥è·¨åŸŸè®¿é—®ä»»ä½•ç½‘ç«™è€Œæ— éœ€è¦æ±‚å¯¹æ–¹è®¾ç½® `CORS`ã€‚ä¸æ­¢æ˜¯ `background`ï¼Œæ‰€æœ‰çš„ç›´æ¥é€šè¿‡ `chrome-extension://id/xx.html` è¿™ç§æ–¹å¼æ‰“å¼€çš„ç½‘é¡µéƒ½å¯ä»¥æ— é™åˆ¶è·¨åŸŸã€‚

```json
{
  //Â ä¼šä¸€ç›´å¸¸é©»çš„åå°JSæˆ–åå°é¡µé¢
  "background": {
    //Â 2ç§æŒ‡å®šæ–¹å¼ï¼Œå¦‚æœæŒ‡å®šJSï¼Œé‚£ä¹ˆä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªèƒŒæ™¯é¡µ
    "page": "background.html" //"scripts":Â ["js/background.js"]
  }
}
```

::: tip
éœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡ `chrome-extension://xxx/background.html` ç›´æ¥æ‰“å¼€åå°é¡µï¼Œä½†æ˜¯æ‰“å¼€çš„åå°é¡µå’ŒçœŸæ­£ä¸€ç›´åœ¨åå°è¿è¡Œçš„é‚£ä¸ªé¡µé¢ä¸æ˜¯åŒä¸€ä¸ªï¼Œæ¢å¥è¯è¯´ï¼Œå¯ä»¥æ‰“å¼€æ— æ•°ä¸ª `background.html`ï¼Œä½†æ˜¯çœŸæ­£åœ¨åå°å¸¸é©»çš„åªæœ‰ä¸€ä¸ªï¼Œè€Œä¸”æ°¸è¿œçœ‹ä¸åˆ°å®ƒçš„ç•Œé¢ï¼Œåªèƒ½è°ƒè¯•å®ƒçš„ä»£ç ã€‚
:::

- `event-pages`
  é‰´äº `background` ç”Ÿå‘½å‘¨æœŸå¤ªé•¿ï¼Œé•¿æ—¶é—´æŒ‚è½½åå°å¯èƒ½ä¼šå½±å“æ€§èƒ½ï¼Œæ‰€ä»¥ `Google` åˆå¼„ä¸€ä¸ª `event-pages`ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸Šï¼Œå®ƒä¸ `background` çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯å¤šäº†ä¸€ä¸ª `persistent` å‚æ•°ã€‚

```json
{
  "background": {
    "scripts": ["event-page.js"],
    "persistent": false
  }
}
```

å®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¯ï¼šåœ¨è¢«éœ€è¦æ—¶åŠ è½½ï¼Œåœ¨ç©ºé—²æ—¶è¢«å…³é—­ï¼Œä»€ä¹ˆå«è¢«éœ€è¦æ—¶å‘¢ï¼Ÿæ¯”å¦‚ç¬¬ä¸€æ¬¡å®‰è£…ã€æ’ä»¶æ›´æ–°ã€æœ‰ `content-script` å‘å®ƒå‘é€æ¶ˆæ¯ï¼Œç­‰ç­‰ã€‚
é™¤äº†é…ç½®æ–‡ä»¶çš„å˜åŒ–ï¼Œä»£ç ä¸Šä¹Ÿæœ‰ä¸€äº›ç»†å¾®å˜åŒ–ï¼Œè¿™ä¸ªç®€å•äº†è§£ä¸€ä¸‹å°±è¡Œäº†ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ background ä¹Ÿä¸ä¼šå¾ˆæ¶ˆè€—æ€§èƒ½çš„ã€‚

> `popup`ï¼š æ˜¯ç‚¹å‡» `browser_action` æˆ–è€… `page_action` å›¾æ ‡æ—¶æ‰“å¼€çš„ä¸€ä¸ªå°çª—å£ç½‘é¡µï¼Œç„¦ç‚¹ç¦»å¼€ç½‘é¡µå°±ç«‹å³å…³é—­ï¼Œä¸€èˆ¬ç”¨æ¥åšä¸€äº›ä¸´æ—¶æ€§çš„äº¤äº’ã€‚

![](https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/popup.png)

`popup` å¯ä»¥åŒ…å«ä»»æ„ä½ æƒ³è¦çš„ `HTML` å†…å®¹ï¼Œå¹¶ä¸”ä¼šè‡ªé€‚åº”å¤§å°ã€‚å¯ä»¥é€šè¿‡ `default_popup` å­—æ®µæ¥æŒ‡å®š `popup` é¡µé¢ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ `setPopup()`æ–¹æ³•ã€‚
é…ç½® ğŸŒ°ï¼š

```json
{
  "browser_action": {
    "default_icon": "img/icon.png", //Â å›¾æ ‡æ‚¬åœæ—¶çš„æ ‡é¢˜ï¼Œå¯é€‰
    "default_title": "è¿™æ˜¯ä¸€ä¸ªChromeæ’ä»¶",
    "default_popup": "popup.html"
  }
}
```

::: warning
éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œç”±äºå•å‡»å›¾æ ‡æ‰“å¼€ `popup`ï¼Œç„¦ç‚¹ç¦»å¼€åˆç«‹å³å…³é—­ï¼Œæ‰€ä»¥ `popup` é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸä¸€èˆ¬å¾ˆçŸ­ï¼Œéœ€è¦é•¿æ—¶é—´è¿è¡Œçš„ä»£ç åƒä¸‡ä¸è¦å†™åœ¨ `popup` é‡Œé¢ã€‚

åœ¨æƒé™ä¸Šï¼Œå®ƒå’Œ `background` éå¸¸ç±»ä¼¼ï¼Œå®ƒä»¬ä¹‹é—´æœ€å¤§çš„ä¸åŒæ˜¯ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒï¼Œ`popup` ä¸­å¯ä»¥ç›´æ¥é€šè¿‡ `chrome.extension.getBackgroundPage()`è·å– `background`çš„ `window` å¯¹è±¡ã€‚
:::

> `inject-script`ï¼šæŒ‡çš„æ˜¯é€šè¿‡ `DOM` æ“ä½œçš„æ–¹å¼å‘é¡µé¢æ³¨å…¥çš„ä¸€ç§ `JS`ã€‚ä¸ºä»€ä¹ˆè¦æŠŠè¿™ç§ `JS` å•ç‹¬æ‹¿å‡ºæ¥è®¨è®ºå‘¢ï¼Ÿåˆæˆ–è€…è¯´ä¸ºä»€ä¹ˆéœ€è¦é€šè¿‡è¿™ç§æ–¹å¼æ³¨å…¥ `JS` å‘¢ï¼Ÿ
> è¿™æ˜¯å› ä¸º `c`ontent-script`æœ‰ä¸€ä¸ªå¾ˆå¤§çš„â€œç¼ºé™·â€ï¼Œä¹Ÿå°±æ˜¯æ— æ³•è®¿é—®é¡µé¢ä¸­çš„`JS`ï¼Œè™½ç„¶å®ƒå¯ä»¥æ“ä½œ `DOM`ï¼Œä½†æ˜¯ `DOM`å´ä¸èƒ½è°ƒç”¨å®ƒï¼Œä¹Ÿå°±æ˜¯æ— æ³•åœ¨`DOM`ä¸­é€šè¿‡ç»‘å®šäº‹ä»¶çš„æ–¹å¼è°ƒç”¨`content-script`ä¸­çš„ä»£ç ï¼ˆåŒ…æ‹¬ç›´æ¥å†™`onclick`å’Œ`addEventListener`ä¸¤ç§æ–¹å¼éƒ½ä¸è¡Œï¼‰ï¼Œä½†æ˜¯ï¼Œâ€œåœ¨é¡µé¢ä¸Šæ·»åŠ ä¸€ä¸ªæŒ‰é’®å¹¶è°ƒç”¨æ’ä»¶çš„æ‰©å±•`API`â€æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„éœ€æ±‚ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå…¶å®è¿™å°±æ˜¯æœ¬å°èŠ‚è¦è®²çš„ã€‚

åœ¨ `content-script` ä¸­é€šè¿‡ `DOM` æ–¹å¼å‘é¡µé¢æ³¨å…¥ `inject-script` ä»£ç ç¤ºä¾‹ï¼š

```javascript
//Â å‘é¡µé¢æ³¨å…¥JS
function injectCustomJs(jsPath) {
  jsPath = jsPath || "js/inject.js";
  var temp = document.createElement("script");
  temp.setAttribute("type", "text/javascript"); //Â è·å¾—çš„åœ°å€ç±»ä¼¼ï¼šchrome-extension://ihcokhadfjfchaeagdoclpnjdiokfakg/js/inject.js
  temp.src = chrome.extension.getURL(jsPath);
  temp.onload = function () {
    //Â æ”¾åœ¨é¡µé¢ä¸å¥½çœ‹ï¼Œæ‰§è¡Œå®Œåç§»é™¤æ‰
    this.parentNode.removeChild(this);
  };
  document.head.appendChild(temp);
}
```

åœ¨ `web` ä¸­ç›´æ¥è®¿é—®æ’ä»¶ä¸­çš„èµ„æºçš„è¯å¿…é¡»æ˜¾ç¤ºå£°æ˜æ‰è¡Œï¼Œé…ç½®æ–‡ä»¶ä¸­å¢åŠ å¦‚ä¸‹

```json
{
  //Â æ™®é€šé¡µé¢èƒ½å¤Ÿç›´æ¥è®¿é—®çš„æ’ä»¶èµ„æºåˆ—è¡¨ï¼Œå¦‚æœä¸è®¾ç½®æ˜¯æ— æ³•ç›´æ¥è®¿é—®çš„
  "web_accessible_resources": ["js/inject.js"]
}
```

### å±•ç°å½¢å¼

> `tab browserAction`ï¼šé€šè¿‡é…ç½® `browser_action` å¯ä»¥åœ¨æµè§ˆå™¨çš„å³ä¸Šè§’å¢åŠ ä¸€ä¸ªå›¾æ ‡ï¼Œä¸€ä¸ª `browser_action` å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªå›¾æ ‡ï¼Œä¸€ä¸ª `tooltip`ï¼Œä¸€ä¸ª `badge` å’Œä¸€ä¸ª `popup`ã€‚

- `icon`(å›¾æ ‡)
  `browser_action`å›¾æ ‡æ¨èä½¿ç”¨å®½é«˜éƒ½ä¸º `19 åƒç´ `çš„å›¾ç‰‡ï¼Œæ›´å¤§çš„å›¾æ ‡ä¼šè¢«ç¼©å°ï¼Œæ ¼å¼éšæ„ï¼Œä¸€èˆ¬æ¨è `png`ï¼Œå¯ä»¥é€šè¿‡ `manifest` ä¸­ `default_icon` å­—æ®µé…ç½®ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ `setIcon()`æ–¹æ³•ã€‚
- `tooltip`
  ä¿®æ”¹ `browser_action` çš„ `manifest` ä¸­ `default_title` å­—æ®µï¼Œæˆ–è€…è°ƒç”¨ `setTitle()`æ–¹æ³•ã€‚

![](https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/tooltip.png)

- `badge`
  æ‰€è°“ `badge`å°±æ˜¯åœ¨å›¾æ ‡ä¸Šæ˜¾ç¤ºä¸€äº›æ–‡æœ¬ï¼Œå¯ä»¥ç”¨æ¥æ›´æ–°ä¸€äº›å°çš„æ‰©å±•çŠ¶æ€æç¤ºä¿¡æ¯ã€‚å› ä¸º `badge` ç©ºé—´æœ‰é™ï¼Œæ‰€ä»¥åªæ”¯æŒ 4 ä¸ªä»¥ä¸‹çš„å­—ç¬¦ï¼ˆè‹±æ–‡ 4 ä¸ªï¼Œä¸­æ–‡ 2 ä¸ªï¼‰ã€‚`badge` æ— æ³•é€šè¿‡é…ç½®æ–‡ä»¶æ¥æŒ‡å®šï¼Œå¿…é¡»é€šè¿‡ä»£ç å®ç°ï¼Œè®¾ç½® `badge` æ–‡å­—å’Œé¢œè‰²å¯ä»¥åˆ†åˆ«ä½¿ç”¨ `setBadgeText()`å’Œ `setBadgeBackgroundColor()`ã€‚

```javascript
chrome.browserAction.setBadgeText({ text: "new" });
chrome.browserAction.setBadgeBackgroundColor({ color: [255, 0, 0, 255] });
```

![](https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/badge.png)

> `pageAction`ï¼šæ‰€è°“ pageActionï¼ŒæŒ‡çš„æ˜¯åªæœ‰å½“æŸäº›ç‰¹å®šé¡µé¢æ‰“å¼€æ‰æ˜¾ç¤ºçš„å›¾æ ‡ï¼Œå®ƒå’Œ `browserAction` æœ€å¤§çš„åŒºåˆ«æ˜¯ä¸€ä¸ªå§‹ç»ˆéƒ½æ˜¾ç¤ºï¼Œä¸€ä¸ªåªåœ¨ç‰¹å®šæƒ…å†µæ‰æ˜¾ç¤ºã€‚

> `å³é”®èœå•`ï¼šé€šè¿‡å¼€å‘ `Chrome` æ’ä»¶å¯ä»¥è‡ªå®šä¹‰æµè§ˆå™¨çš„å³é”®èœå•ï¼Œä¸»è¦æ˜¯é€šè¿‡ `chrome.contextMenusAPI` å®ç°ï¼Œå³é”®èœå•å¯ä»¥å‡ºç°åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ï¼Œæ¯”å¦‚æ™®é€šé¡µé¢ã€é€‰ä¸­çš„æ–‡å­—ã€å›¾ç‰‡ã€é“¾æ¥ï¼Œç­‰ç­‰ï¼Œå¦‚æœæœ‰åŒä¸€ä¸ªæ’ä»¶é‡Œé¢å®šä¹‰äº†å¤šä¸ªèœå•ï¼Œ`Chrome`ä¼šè‡ªåŠ¨ç»„åˆæ”¾åˆ°ä»¥æ’ä»¶åå­—å‘½åçš„äºŒçº§èœå•é‡Œï¼Œå¦‚ä¸‹ï¼š

```javascript
//Â manifest.json
{"permissions":Â ["contextMenus"]}

//Â background.js
chrome.contextMenus.create({
Â title:Â "æµ‹è¯•å³é”®èœå•",
Â onclick:Â function(){alert('æ‚¨ç‚¹å‡»äº†å³é”®èœå•ï¼');}
});
```

![](https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/click.png)

> `override`ï¼šä½¿ç”¨ `override` é¡µå¯ä»¥å°† `Chrome` é»˜è®¤çš„ä¸€äº›ç‰¹å®šé¡µé¢æ›¿æ¢æ‰ï¼Œæ”¹ä¸ºä½¿ç”¨æ‰©å±•æä¾›çš„é¡µé¢ã€‚
> æ‰©å±•å¯ä»¥æ›¿ä»£å¦‚ä¸‹é¡µé¢ï¼š

- å†å²è®°å½•ï¼šä»å·¥å…·èœå•ä¸Šç‚¹å‡»å†å²è®°å½•æ—¶è®¿é—®çš„é¡µé¢ï¼Œæˆ–è€…ä»åœ°å€æ ç›´æ¥è¾“å…¥ `chrome://history`
- æ–°æ ‡ç­¾é¡µï¼šå½“åˆ›å»ºæ–°æ ‡ç­¾çš„æ—¶å€™è®¿é—®çš„é¡µé¢ï¼Œæˆ–è€…ä»åœ°å€æ ç›´æ¥è¾“å…¥ `c`hrome://newtab`
- ä¹¦ç­¾ï¼šæµè§ˆå™¨çš„ä¹¦ç­¾ï¼Œæˆ–è€…ç›´æ¥è¾“å…¥ `chrome://bookmarks`
  ::: warning
- ä¸€ä¸ªæ‰©å±•åªèƒ½æ›¿ä»£ä¸€ä¸ªé¡µé¢ï¼›
- ä¸èƒ½æ›¿ä»£éšèº«çª—å£çš„æ–°æ ‡ç­¾é¡µï¼›
- ç½‘é¡µå¿…é¡»è®¾ç½® `title`ï¼Œå¦åˆ™ç”¨æˆ·å¯èƒ½ä¼šçœ‹åˆ°ç½‘é¡µçš„ `URL`ï¼Œé€ æˆå›°æ‰°ï¼›
  :::

```json
"chrome_url_overrides":
{
Â "newtab":Â "newtab.html",
Â "history":Â "history.html",
Â "bookmarks":Â "bookmarks.html"
}
```

![](https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/override.png)

> `devtools`ï¼š`Chrome` å…è®¸æ’ä»¶åœ¨å¼€å‘è€…å·¥å…·(`devtools`)ä¸ŠåŠ¨æ‰‹è„šï¼Œä¸»è¦è¡¨ç°åœ¨ï¼š

- è‡ªå®šä¹‰ä¸€ä¸ªå’Œå¤šä¸ªå’Œ `Elementsã€Consoleã€Sources` ç­‰åŒçº§åˆ«çš„é¢æ¿ï¼›
- è‡ªå®šä¹‰ä¾§è¾¹æ (`sidebar`)ï¼Œç›®å‰åªèƒ½è‡ªå®šä¹‰ `Elements` é¢æ¿çš„ä¾§è¾¹æ ï¼›
- `devtools` æ‰©å±•ä»‹ç»
  ![](https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/vue.png)
  ![](https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/devtools.png)

- æ¯æ‰“å¼€ä¸€ä¸ªå¼€å‘è€…å·¥å…·çª—å£ï¼Œéƒ½ä¼šåˆ›å»º `devtools` é¡µé¢çš„å®ä¾‹ï¼Œ`F12` çª—å£å…³é—­ï¼Œé¡µé¢ä¹Ÿéšç€å…³é—­ï¼Œæ‰€ä»¥ `devtools` é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸå’Œ `devtools` çª—å£æ˜¯ä¸€è‡´çš„ã€‚`devtools` é¡µé¢å¯ä»¥è®¿é—®ä¸€ç»„ç‰¹æœ‰çš„ `DevTools API` ä»¥åŠæœ‰é™çš„æ‰©å±• `API`ï¼Œè¿™ç»„ç‰¹æœ‰çš„ `DevTools API` åªæœ‰ `devtools` é¡µé¢æ‰å¯ä»¥è®¿é—®ï¼Œ`background` éƒ½æ— æƒè®¿é—®ï¼Œè¿™äº› `API` åŒ…æ‹¬ï¼š
- `chrome.devtools.panels`ï¼šé¢æ¿ç›¸å…³ï¼›
- `chrome.devtools.inspectedWindow`ï¼šè·å–è¢«å®¡æŸ¥çª—å£çš„æœ‰å…³ä¿¡æ¯ï¼›
- `chrome.devtools.network`ï¼šè·å–æœ‰å…³ç½‘ç»œè¯·æ±‚çš„ä¿¡æ¯ï¼›
  `options` é¡µï¼Œå°±æ˜¯æ’ä»¶çš„è®¾ç½®é¡µé¢ï¼Œæœ‰ 2 ä¸ªå…¥å£ï¼Œä¸€ä¸ªæ˜¯å³é”®å›¾æ ‡æœ‰ä¸€ä¸ªâ€œé€‰é¡¹â€èœå•ï¼Œè¿˜æœ‰ä¸€ä¸ªåœ¨æ’ä»¶ç®¡ç†é¡µé¢ï¼š
  > å¤§éƒ¨åˆ†æ‰©å±• `API` éƒ½æ— æ³•ç›´æ¥è¢« `DevTools` é¡µé¢è°ƒç”¨ï¼Œä½†å®ƒå¯ä»¥åƒ `content-script` ä¸€æ ·ç›´æ¥è°ƒç”¨ `chrome.extension` å’Œ `chrome.runtimeAPI`ï¼ŒåŒæ—¶å®ƒä¹Ÿå¯ä»¥åƒ `content-script` ä¸€æ ·ä½¿ç”¨ `Message` äº¤äº’çš„æ–¹å¼ä¸ `background` é¡µé¢è¿›è¡Œé€šä¿¡ã€‚

> `option`ï¼š

```json
{
  "options_ui": {
    "page": "options.html", //Â æ·»åŠ ä¸€äº›é»˜è®¤çš„æ ·å¼ï¼Œæ¨èä½¿ç”¨
    "chrome_style": true
  }
}
```

![](https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/option.png)

![](https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/option1.png)

> `omnibox`ï¼š æ˜¯å‘ç”¨æˆ·æä¾›æœç´¢å»ºè®®çš„ä¸€ç§æ–¹å¼ã€‚

> `omnibox` åº”ç”¨ç¨‹åºç•Œé¢å…è®¸å‘ `Google Chrome` çš„åœ°å€æ æ³¨å†Œä¸€ä¸ªå…³é”®å­—ï¼Œåœ°å€æ ä¹Ÿå« `omnibox`ã€‚
> å½“ç”¨æˆ·è¾“å…¥ä½ çš„æ‰©å±•å…³é”®å­—ï¼Œç”¨æˆ·å¼€å§‹ä¸ä½ çš„æ‰©å±•äº¤äº’ã€‚æ¯ä¸ªå‡»é”®éƒ½ä¼šå‘é€ç»™ä½ çš„æ‰©å±•ï¼Œæ‰©å±•æä¾›å»ºè®®ä½œä¸ºç›¸åº”çš„å“åº”ã€‚
> å»ºè®®å¯ä»¥è¢«æ ¼å¼åŒ–å¤šç§æ–¹å¼ã€‚å½“ç”¨æˆ·æ¥å—å»ºè®®ï¼Œä½ çš„æ‰©å±•è¢«é€šçŸ¥å¯ä»¥æ‰§è¡ŒåŠ¨ä½œã€‚

![](https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/go.gif)

> é…ç½®å­—æ®µï¼š

```json
{
  //Â å‘åœ°å€æ æ³¨å†Œä¸€ä¸ªå…³é”®å­—ä»¥æä¾›æœç´¢å»ºè®®ï¼Œåªèƒ½è®¾ç½®ä¸€ä¸ªå…³é”®å­—
  "omnibox": { "keyword": "go" }
}
```

åœ¨ `background.js` æ³¨å†Œç›‘å¬äº‹ä»¶ï¼š

```javascript
chrome.omnibox.onInputChanged.addListener((text, suggest) => {
  console.log("inputChanged:Â " + text);
  if (!text) return;
  if (text == "å¾®åš") {
    suggest([
      { content: "æ–°æµª" + text, description: "æ–°æµª" + text },
      { content: "è…¾è®¯" + text, description: "è…¾è®¯" + text },
      { content: "æœç‹" + text, description: "æœç´¢" + text },
    ]);
  } else {
    suggest([
      { content: "ç™¾åº¦æœç´¢Â " + text, description: "ç™¾åº¦æœç´¢Â " + text },
      { content: "è°·æ­Œæœç´¢Â " + text, description: "è°·æ­Œæœç´¢Â " + text },
    ]);
  }
});

//Â å½“ç”¨æˆ·æ¥æ”¶å…³é”®å­—å»ºè®®æ—¶è§¦å‘
chrome.omnibox.onInputEntered.addListener((text) => {
  console.log("inputEntered:Â " + text);
  if (!text) return;
  var href = "";
  if (text.endsWith("å¾®åš"))
    href =
      "http://image.baidu.com/search/index?tn=baiduimage&ie=utf-8&word=" + text;
  else if (text.startsWith("ç™¾åº¦æœç´¢"))
    href =
      "https://www.baidu.com/s?ie=UTF-8&wd=" + text.replace("ç™¾åº¦æœç´¢Â ", "");
  else if (text.startsWith("è°·æ­Œæœç´¢"))
    href =
      "https://www.google.com.tw/search?q=" + text.replace("è°·æ­Œæœç´¢Â ", "");
  else href = "https://www.baidu.com/s?ie=UTF-8&wd=" + text;
  openUrlCurrentTab(href);
});
//Â è·å–å½“å‰é€‰é¡¹å¡ID
function getCurrentTabId(callback) {
  chrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {
    if (callback) callback(tabs.length ? tabs[0].id : null);
  });
}

//Â å½“å‰æ ‡ç­¾æ‰“å¼€æŸä¸ªé“¾æ¥
function openUrlCurrentTab(url) {
  getCurrentTabId((tabId) => {
    chrome.tabs.update(tabId, { url: url });
  });
}
```

> `notification`ï¼šé€šçŸ¥ç”¨æˆ·å‘ç”Ÿäº†ä¸€äº›é‡è¦çš„äº‹æƒ…ã€‚æ¡Œé¢é€šçŸ¥ä¼šæ˜¾ç¤ºåœ¨æµè§ˆå™¨çª—å£ä¹‹å¤–ã€‚
> `Chrome` æä¾›äº†ä¸€ä¸ª `chrome.notificationsAPI` ä»¥ä¾¿æ’ä»¶æ¨é€æ¡Œé¢é€šçŸ¥ï¼Œæš‚æœªæ‰¾åˆ° `chrome.notifications` å’Œ `HTML5` è‡ªå¸¦çš„ `Notification` çš„æ˜¾è‘—åŒºåˆ«åŠä¼˜åŠ¿ã€‚

åœ¨åå° `JS` ä¸­ï¼Œæ— è®ºæ˜¯ä½¿ç”¨ `chrome.notifications` è¿˜æ˜¯ `Notification` éƒ½ä¸éœ€è¦ç”³è¯·æƒé™ï¼ˆ`HTML5` æ–¹å¼éœ€è¦ç”³è¯·æƒé™ï¼‰ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚

## äº”ç±» JS æ–‡ä»¶åŒºåˆ«

| js ç±»å‹         | å¯è®¿é—®çš„ API                                     | DOM è®¿é—®æƒ…å†µ   | js è®¿é—®æƒ…å†µ | è·¨åŸŸ | è°ƒè¯•æ–¹å¼                                                                                                              |
| --------------- | ------------------------------------------------ | -------------- | ----------- | ---- | --------------------------------------------------------------------------------------------------------------------- |
| content script  | åªèƒ½è®¿é—® extensionã€runtime ç­‰éƒ¨åˆ† API           | âœ”              | Ã—           | Ã—    | æ‰“å¼€ Console,å¦‚å›¾åˆ‡æ¢![tiaoshi.png](https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/tiaoshi.png)        |
| popup js        | å¯è®¿é—®ç»å¤§éƒ¨åˆ† APIï¼Œé™¤äº† devtools ç³»åˆ—           | ä¸å¯ä»¥ç›´æ¥è®¿é—® | Ã—           | âœ”    | popup é¡µé¢å³é”®é€‰æ‹©â€œå®¡æŸ¥å¼¹å‡ºå†…å®¹â€                                                                                      |
| background js   | å¯è®¿é—®ç»å¤§éƒ¨åˆ† APIï¼Œé™¤äº† devtools ç³»åˆ—           | ä¸å¯ä»¥ç›´æ¥è®¿é—® | Ã—           | âœ”    | æ’ä»¶ç®¡ç†é¡µé¢ç‚¹å‡»èƒŒæ™¯é¡µ![background.png](https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/background.png) |
| devtools js     | åªèƒ½è®¿é—® devtoolsã€extensionã€runtime ç­‰éƒ¨åˆ† API | âœ”              | âœ”           | Ã—    | æš‚æ—¶æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„è°ƒè¯•æ–¹æ³•                                                                                            |
| injected script | å’Œæ™®é€š JS æ— ä»»ä½•å·®åˆ«ï¼Œä¸èƒ½è®¿é—®ä»»ä½•æ‰©å±• API       | âœ”              | âœ”           | Ã—    | ç›´æ¥æ™®é€šçš„ F12 å³å¯                                                                                                   |

---

## æ¶ˆæ¯é€šä¿¡

### é€šä¿¡æ–¹å¼æ¦‚è§ˆ

| -               | injected-script                       | content-script                              | popup-js                                          | background-js                                     |
| --------------- | ------------------------------------- | ------------------------------------------- | ------------------------------------------------- | ------------------------------------------------- |
| injected-script | --                                    | window.postMessage                          | --                                                | --                                                |
| content-script  | window.postMessage                    | --                                          | chrome.runtime.sendMessage chrome.runtime.connect | chrome.runtime.sendMessage chrome.runtime.connect |
| popup-js        | --                                    | chrome.tabs.sendMessage chrome.tabs.connect | --                                                | chrome.extension.getBackgroundPage()              |
| background-js   | --                                    | chrome.tabs.sendMessage chrome.tabs.connect | chrome.extension.getViews                         | --                                                |
| devtools-js     | chrome.devtools. inspectedWindow.eval | --                                          | chrome.runtime.sendMessage                        | chrome.runtime.sendMessage                        |

### popup&&background

- `popup` è®¿é—® `background`
  > `popup` å¯ä»¥ç›´æ¥è°ƒç”¨ `background` çš„ JS æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥è®¿é—® `background` çš„ DOM

```javascript
//Â background.js
function test() {
  alert("æˆ‘æ˜¯backgroundï¼");
}

//Â popup.js
var bg = chrome.extension.getBackgroundPage();
bg.test(); //Â è®¿é—®bgçš„å‡½æ•°
alert(bg.document.body.innerHTML); //Â è®¿é—®bgçš„DOM
```

- `background` è®¿é—® `popup`
  ::: warning
  å‰ææ˜¯ `popup` å·²ç»æ‰“å¼€æ—¶
  :::

```javascript
var views = chrome.extension.getViews({ type: "popup" });
if (views.length > 0) {
  console.log(views[0].location.href);
}
```

### (popup/background)&&content-script

- `popup.js/background.js`

```javascript
function sendMessageToContentScript(message, callback) {
  chrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {
    chrome.tabs.sendMessage(tabs[0].id, message, function (response) {
      if (callback) callback(response);
    });
  });
}
sendMessageToContentScript(
  { cmd: "test", value: "ä½ å¥½ï¼Œæˆ‘æ˜¯popupï¼" },
  function (response) {
    console.log("æ¥è‡ªcontentçš„å›å¤ï¼š" + response);
  }
);
```

- `content-script` æ¥æ”¶æ¶ˆæ¯

```javascript
chrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {
  //Â console.log(sender.tabÂ ?"fromÂ aÂ contentÂ script:"Â +Â sender.tab.urlÂ :"fromÂ theÂ extension");
  if (request.cmd == "test") alert(request.value);
  sendResponse("æˆ‘æ”¶åˆ°äº†ä½ çš„æ¶ˆæ¯ï¼");
});
```

> åŒæ–¹é€šä¿¡ç›´æ¥å‘é€çš„éƒ½æ˜¯ `JSON` å¯¹è±¡ï¼Œä¸æ˜¯ `JSON` å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æ— éœ€è§£æï¼Œå¾ˆæ–¹ä¾¿ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥å‘é€å­—ç¬¦ä¸²ï¼‰ã€‚

### content-script&&(background/popup)

- `content-script.js`

```javascript
chrome.runtime.sendMessage(
  { greeting: "ä½ å¥½ï¼Œæˆ‘æ˜¯content-scriptï¼Œä¸»åŠ¨å‘æ¶ˆæ¯ç»™åå°ï¼" },
  function (response) {
    console.log("æ”¶åˆ°æ¥è‡ªåå°çš„å›å¤ï¼š" + response);
  }
);
```

- `background.js/popup.js` æ¥æ”¶æ¶ˆæ¯

```javascript
//Â ç›‘å¬æ¥è‡ªcontent-scriptçš„æ¶ˆæ¯
chrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {
  console.log("æ”¶åˆ°æ¥è‡ªcontent-scriptçš„æ¶ˆæ¯ï¼š");
  console.log(request, sender, sendResponse);
  sendResponse("æˆ‘æ˜¯åå°ï¼Œæˆ‘å·²æ”¶åˆ°ä½ çš„æ¶ˆæ¯ï¼š" + JSON.stringify(request));
});
```

::: warning

- `content_script` å‘ `popup` ä¸»åŠ¨å‘æ¶ˆæ¯çš„å‰ææ˜¯ `popup` å¿…é¡»æ‰“å¼€ï¼å¦åˆ™éœ€è¦åˆ©ç”¨ `background` ä½œä¸­è½¬ã€‚
- å¦‚æœ `background` å’Œ `popup` åŒæ—¶ç›‘å¬ï¼Œé‚£ä¹ˆå®ƒä»¬éƒ½å¯ä»¥åŒæ—¶æ”¶åˆ°æ¶ˆæ¯ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªå¯ä»¥ `sendResponse`ï¼Œä¸€ä¸ªå…ˆå‘é€äº†ï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ªå†å‘é€å°±æ— æ•ˆã€‚
  :::

### inject-script&&content-script

`content-script` å’Œé¡µé¢å†…çš„è„šæœ¬ï¼ˆ`injected-script` è‡ªç„¶ä¹Ÿå±äºé¡µé¢å†…çš„è„šæœ¬ï¼‰ä¹‹é—´å”¯ä¸€å…±äº«çš„ä¸œè¥¿å°±æ˜¯é¡µé¢çš„ DOM å…ƒç´ ï¼Œæœ‰ 2 ç§æ–¹æ³•å¯ä»¥å®ç°äºŒè€…é€šè®¯ï¼š

- 1.å¯ä»¥é€šè¿‡ `window.postMessage` å’Œ `window.addEventListener` æ¥å®ç°äºŒè€…æ¶ˆæ¯é€šè®¯(æ¨è)
- `inject-script`:

```javascript
window.postMessage({ test: "Hello,Content" }, "*");
```

- `content-script`:

```javascript
window.addEventListener(
  "message",
  function (e) {
    console.log(e.data);
  },
  false
);
```

- 2.é€šè¿‡è‡ªå®šä¹‰ DOM äº‹ä»¶æ¥å®ç°
- `inject-script`:

```javascript
var customEvent = document.createEvent("Event");
customEvent.initEvent("myCustomEvent", true, true);
function fireCustomEvent(data) {
  hiddenDiv = document.getElementById("myCustomEventDiv");
  hiddenDiv.innerText = data;
  hiddenDiv.dispatchEvent(customEvent);
}
fireCustomEvent("Hello! Iâ€™m Injected");
```

- `content-script`:

```javascript
var hiddenDiv = document.getElementById("myCustomEventDiv");
if (!hiddenDiv) {
  hiddenDiv = document.createElement("div");
  hiddenDiv.style.display = "none";
  document.body.appendChild(hiddenDiv);
}
hiddenDiv.addEventListener("myCustomEvent", function () {
  var eventData = document.getElementById("myCustomEventDiv").innerText;
  console.log("æ”¶åˆ°è‡ªå®šä¹‰äº‹ä»¶æ¶ˆæ¯ï¼š" + eventData);
});
```

---

## è¡¥å……

### åŠ¨æ€æ³¨å…¥ JSã€CSS

> è™½ç„¶åœ¨ `background` å’Œ `popup` ä¸­æ— æ³•ç›´æ¥è®¿é—®é¡µé¢ DOMï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ `chrome.tabs.executeScript` æ¥æ‰§è¡Œè„šæœ¬ï¼Œä»è€Œå®ç°è®¿é—® web é¡µé¢çš„ DOMï¼ˆæ³¨æ„ï¼Œè¿™ç§æ–¹å¼ä¹Ÿä¸èƒ½ç›´æ¥è®¿é—®é¡µé¢ JSï¼‰ã€‚

`manifest.json` é…ç½® ğŸŒ°ï¼š

```json
{
Â "name":Â "åŠ¨æ€æ³¨å…¥JS/CSS",
Â ...
Â "permissions":Â [
Â Â "tabs",Â "http://*/*",Â "https://*/*"
Â ],
Â ...
}
```

```javascript
//Â åŠ¨æ€æ‰§è¡ŒJSä»£ç 
chrome.tabs.executeScript(tabId, {
  code: 'document.body.style.backgroundColor="red"',
});
//Â åŠ¨æ€æ‰§è¡ŒJSæ–‡ä»¶
chrome.tabs.executeScript(tabId, { file: "some-script.js" });

//Â åŠ¨æ€æ‰§è¡ŒCSSä»£ç 
chrome.tabs.insertCSS(tabId, { code: "xxx" });
//Â åŠ¨æ€æ‰§è¡ŒCSSæ–‡ä»¶
chrome.tabs.insertCSS(tabId, { file: "some-style.css" });
```

### è·å–å½“å‰çª—å£ ID

```javascript
chrome.windows.getCurrent(function (currentWindow) {
  console.log("å½“å‰çª—å£IDï¼š" + currentWindow.id);
});
```

### è·å–å½“å‰æ ‡ç­¾é¡µ ID

```javascript
//Â è·å–å½“å‰é€‰é¡¹å¡ID
function getCurrentTabId(callback) {
  chrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {
    if (callback) callback(tabs.length ? tabs[0].id : null);
  });
}
```

### æœ¬åœ°å­˜å‚¨

æœ¬åœ°å­˜å‚¨å»ºè®®ç”¨ `chrome.storage` è€Œä¸æ˜¯æ™®é€šçš„ `localStorage`ï¼ŒåŒºåˆ«æœ‰å¥½å‡ ç‚¹ï¼Œæœ€é‡è¦çš„ 2 ç‚¹åŒºåˆ«æ˜¯ï¼š

- `chrome.storage` æ˜¯é’ˆå¯¹æ’ä»¶å…¨å±€çš„ï¼Œå³ä½¿ä½ åœ¨ `background` ä¸­ä¿å­˜çš„æ•°æ®ï¼Œåœ¨ `content-script` ä¹Ÿèƒ½è·å–åˆ°ã€‚
- `chrome.storage.sync` å¯ä»¥è·Ÿéšå½“å‰ç™»å½•ç”¨æˆ·è‡ªåŠ¨åŒæ­¥ï¼Œè¿™å°ç”µè„‘ä¿®æ”¹çš„è®¾ç½®ä¼šè‡ªåŠ¨åŒæ­¥åˆ°å…¶å®ƒç”µè„‘ï¼Œå¾ˆæ–¹ä¾¿ï¼Œå¦‚æœæ²¡æœ‰ç™»å½•æˆ–è€…æœªè”ç½‘åˆ™å…ˆä¿å­˜åˆ°æœ¬åœ°ï¼Œç­‰ç™»å½•äº†å†åŒæ­¥è‡³ç½‘ç»œã€‚

> éœ€è¦å£°æ˜ `storage` æƒé™ï¼Œæœ‰ `chrome.storage.sync` å’Œ `chrome.storage.local`2 ç§æ–¹å¼å¯ä¾›é€‰æ‹©ï¼Œä½¿ç”¨ç¤ºä¾‹ ğŸŒ° å¦‚ä¸‹ï¼š

```javascript
//Â è¯»å–æ•°æ®ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æŒ‡å®šè¦è¯»å–çš„keyä»¥åŠè®¾ç½®é»˜è®¤å€¼
chrome.storage.sync.get({ color: "red", age: 18 }, function (items) {
  console.log(items.color, items.age);
});
//Â ä¿å­˜æ•°æ®
chrome.storage.sync.set({ color: "blue" }, function () {
  console.log("ä¿å­˜æˆåŠŸï¼");
});
```

### webRequest

é€šè¿‡ `webRequest` ç³»åˆ— API å¯ä»¥å¯¹ HTTP è¯·æ±‚è¿›è¡Œä»»æ€§åœ°ä¿®æ”¹ã€å®šåˆ¶ã€‚
ç”Ÿå‘½å‘¨æœŸå›¾ï¼š

![](https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/webRequest.png)

```javascript
//manifest.json
{
Â //Â æƒé™ç”³è¯·
Â "permissions":
Â [
Â Â "webRequest",Â //Â webè¯·æ±‚
Â Â "webRequestBlocking",Â //Â é˜»å¡å¼webè¯·æ±‚
Â Â "storage",Â //Â æ’ä»¶æœ¬åœ°å­˜å‚¨
Â Â "http://*/*",Â //Â å¯ä»¥é€šè¿‡executeScriptæˆ–è€…insertCSSè®¿é—®çš„ç½‘ç«™
Â Â "https://*/*"Â //Â å¯ä»¥é€šè¿‡executeScriptæˆ–è€…insertCSSè®¿é—®çš„ç½‘ç«™
Â ],
}


//Â background.js
//Â æ˜¯å¦æ˜¾ç¤ºå›¾ç‰‡
varÂ showImage;
chrome.storage.sync.get({showImage:Â true},Â function(items)Â {
Â showImageÂ =Â items.showImage;
});
// webè¯·æ±‚ç›‘å¬ï¼Œæœ€åä¸€ä¸ªå‚æ•°è¡¨ç¤ºé˜»å¡å¼ï¼Œéœ€å•ç‹¬å£°æ˜æƒé™ï¼šwebRequestBlocking
chrome.webRequest.onBeforeRequest.addListener(detailsÂ =>Â {
Â //Â cancelÂ è¡¨ç¤ºå–æ¶ˆæœ¬æ¬¡è¯·æ±‚
Â if(!showImageÂ &&Â details.typeÂ ==Â 'image')Â returnÂ {cancel:Â true};
Â //Â ç®€å•çš„éŸ³è§†é¢‘æ£€æµ‹
Â //Â å¤§éƒ¨åˆ†ç½‘ç«™è§†é¢‘çš„typeå¹¶ä¸æ˜¯mediaï¼Œä¸”è§†é¢‘åšäº†é˜²ä¸‹è½½å¤„ç†ï¼Œæ‰€ä»¥è¿™é‡Œä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºæ•ˆæœï¼Œæ— å®é™…æ„ä¹‰
Â if(details.typeÂ ==Â 'media')Â {
Â Â chrome.notifications.create(null,Â {
Â Â Â type:Â 'basic',
Â Â Â iconUrl:Â 'img/icon48.png',
Â Â Â title:Â 'æ£€æµ‹åˆ°éŸ³è§†é¢‘',
Â Â Â message:Â 'éŸ³è§†é¢‘åœ°å€ï¼š'Â +Â details.url,
Â Â });
Â }
},Â {urls:Â ["<all_urls>"]},Â ["blocking"]);
```

ç¤ºä¾‹ ğŸŒ°ï¼š

```javascript
// æ¯æ¬¡è¯·æ±‚å‰è§¦å‘ï¼Œå¯ä»¥æ‹¿åˆ° requestBody æ•°æ®ï¼ŒåŒæ—¶å¯ä»¥å¯¹æœ¬æ¬¡è¯·æ±‚ä½œå‡ºå¹²é¢„ä¿®æ”¹
chrome.webRequest.onBeforeRequest.addListener(
  (details) => {
    console.log("onBeforeRequest", details);
  },
  { urls: ["<all_urls>"] },
  ["blocking", "extraHeaders", "requestBody"]
);

// å‘é€headerä¹‹å‰è§¦å‘ï¼Œå¯ä»¥æ‹¿åˆ°è¯·æ±‚headersï¼Œä¹Ÿå¯ä»¥æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤headers
// ä½†ä½¿ç”¨æœ‰ä¸€å®šé™åˆ¶ï¼Œä¸€äº›ç‰¹æ®Šå¤´éƒ¨å¯èƒ½æ‹¿ä¸åˆ°æˆ–è€…å­˜åœ¨ç‰¹æ®Šæƒ…å†µï¼Œè¯¦è§å®˜ç½‘æ–‡æ¡£
chrome.webRequest.onBeforeSendHeaders.addListener(
  (details) => {
    console.log("onBeforeSendHeaders", details);
  },
  { urls: ["<all_urls>"] },
  ["blocking", "extraHeaders", "requestHeaders"]
);

// å¼€å§‹å“åº”è§¦å‘ï¼Œå¯ä»¥æ‹¿åˆ°æœåŠ¡ç«¯è¿”å›çš„headers
chrome.webRequest.onResponseStarted.addListener(
  (details) => {
    console.log("onResponseStarted", details);
  },
  { urls: ["<all_urls>"] },
  ["extraHeaders", "responseHeaders"]
);

// è¯·æ±‚å®Œæˆè§¦å‘ï¼Œèƒ½æ‹¿åˆ°çš„æ•°æ®å’ŒonResponseStartedä¸€æ ·ï¼Œæ³¨æ„æ— æ³•æ‹¿åˆ°responseBody
chrome.webRequest.onCompleted.addListener(
  (details) => {
    console.log("onCompleted", details);
  },
  { urls: ["<all_urls>"] },
  ["extraHeaders", "responseHeaders"]
);
```

ä¸Šé¢ç¤ºä¾‹ä¸­æåˆ°ï¼Œä½¿ç”¨ `webRequestAPI` æ˜¯æ— æ³•æ‹¿åˆ° `responseBody` çš„ï¼Œæƒ³è¦æ‹¿åˆ°çš„è¯åªèƒ½é‡‡å–ä¸€äº›å˜é€šæ–¹æ³•ï¼Œä¾‹å¦‚ï¼š

- é‡å†™ `XmlHttpRequest` å’Œ `fetch`ï¼Œå¢åŠ è‡ªå®šä¹‰æ‹¦æˆªäº‹ä»¶ï¼Œç¼ºç‚¹æ˜¯å®ç°æ–¹å¼å¯èƒ½æœ‰ç‚¹è„ï¼Œé‡å†™ä¸å¥½çš„è¯å¯èƒ½å½±å“æ­£å¸¸é¡µé¢ã€‚
- `devtools` çš„ `chrome.devtools.network.onRequestFinishedAPI` å¯ä»¥æ‹¿åˆ°è¿”å›çš„ bodyï¼Œç¼ºç‚¹æ˜¯å¿…é¡»æ‰“å¼€å¼€å‘è€…é¢æ¿ã€‚
- ä½¿ç”¨ `chrome.debugger.sendCommand` å‘é€ `Network.getResponseBody` å‘½ä»¤æ¥è·å– body å†…å®¹ï¼Œç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œä¼šæœ‰ä¸€ä¸ªæ¼äººçš„æç¤ºã€‚

> å…·ä½“çš„å®ç°æ–¹å¼å¯ä»¥æŸ¥çœ‹[https://stackoverflow.com/questions/18534771/chrome-extension-how-to-get-http-response-body](https://stackoverflow.com/questions/18534771/chrome-extension-how-to-get-http-response-body)

### å›½é™…åŒ–

æ’ä»¶æ ¹ç›®å½•æ–°å»ºä¸€ä¸ªåä¸º`locales` çš„æ–‡ä»¶å¤¹ï¼Œå†åœ¨ä¸‹é¢æ–°å»ºä¸€äº›è¯­è¨€çš„æ–‡ä»¶å¤¹ï¼Œå¦‚ `enã€zh_CNã€zh_TW`ï¼Œç„¶åå†åœ¨æ¯ä¸ªæ–‡ä»¶å¤¹æ”¾å…¥ä¸€ä¸ª `messages.json`ï¼ŒåŒæ—¶å¿…é¡»åœ¨æ¸…å•æ–‡ä»¶ä¸­è®¾ç½® `default_locale`ã€‚

- `\locales\en\messages.json`ï¼š

```json
{
  "pluginDesc": { "message": "A chrome extension demo" },
  "helloWorld": { "message": "Hello World!" }
}
```

- `\locales\zh_CN\messages.json`:

```json
{
  "pluginDesc": { "message": "ä¸€ä¸ªChromeæ’ä»¶demo" },
  "helloWorld": { "message": "ä½ å¥½ï¼Œä¸–ç•Œï¼" }
}
```

- åœ¨ `manifest.json` å’Œ CSS æ–‡ä»¶ä¸­é€šè¿‡**MSG_messagename**å¼•å…¥ï¼Œå¦‚ï¼š

```json
{
  "description": "__MSG_pluginDesc__",
  // é»˜è®¤è¯­è¨€
  "default_locale": "zh_CN"
}
```

- åœ¨ JS ä¸­åˆ™ç›´æ¥ `chrome.i18n.getMessage("helloWorld")`ã€‚
- æµ‹è¯•æ—¶ï¼Œé€šè¿‡ç»™ chrome å»ºç«‹ä¸€ä¸ªä¸åŒçš„å¿«æ·æ–¹å¼ `chrome.exe --lang=en` æ¥åˆ‡æ¢è¯­è¨€

![](https://cdn.jsdelivr.net/gh/lp-Imagine/lp-Imagine@main/images/i18n.png)

## å¸¸è§çš„ API

æ‰€æœ‰çš„ `Chrome API` éƒ½æ˜¯ä»¥ `chrome` å¯¹è±¡å¼€å¤´ï¼ŒğŸŒ° å¦‚ï¼š`chrome.tabs`

- `bookmarks`æ“çºµä¹¦ç­¾çš„ API
- `browserAction` è·å–æ‰©å±•å›¾æ ‡ã€æ ‡é¢˜ã€æ–‡å­—ã€å¼¹å‡ºé¡µç­‰
- `browsingData`æ§åˆ¶æµè§ˆå™¨çš„æµè§ˆæ•°æ®ï¼Œä»æœ¬åœ°æ–‡ä»¶
- `commands` ç»™æ‰©å±•æ·»åŠ å¿«æ·é”®
- `contextMenus` æ·»åŠ é€‰é¡¹åˆ°å³é”®å¼¹å‡ºèœå•
- `cookies`æ§åˆ¶ `cookies`
- `desktopCapture` æ•è·å±å¹•ã€ä¸ªäººçª—å£æˆ–æ ‡ç­¾å†…å®¹
- `downloads` ä¸‹è½½æ§åˆ¶
- `events` äº‹ä»¶ç›¸å…³ API
- `extension` è·å–æ‰©å±•çš„å„éƒ¨åˆ†ï¼Œä¹Ÿèƒ½ä¸å„éƒ¨åˆ†äº¤æ¢ä¿¡æ¯
- `extensionTypes` æ‰©å±•çš„ç±»å‹å£°æ˜
- `gcm` å¯ç”¨ google äº‘æ¶ˆæ¯æœåŠ¡ï¼Œæ”¶å‘æ¶ˆæ¯
- `history` å†å²è®°å½•æ§åˆ¶
- `i18n`å¤šè¯­è¨€å›½é™…åŒ–æ”¯æŒ
- `idle` å–å¾—æœºå™¨é—²ç½®çŠ¶æ€
- `management` ç®¡ç†æ‰©å±•ä¸åº”ç”¨
- `notifications` é€šçŸ¥æ§åˆ¶
- `pageAction` å…·ä½“çš„é¡µé¢ä¸‹æ§åˆ¶æ‰©å±•å›¾æ ‡ã€æ ‡é¢˜ã€æ–‡å­—ã€å¼¹å‡ºé¡µç­‰ç›¸å…³å†…å®¹
- `permissions` è·å–æ‹¥æœ‰çš„æƒé™
- `power` è¯·æ±‚ç³»ç»Ÿå¸¸äº®
- `runtime` è·å–è¿è¡Œæ—¶ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬åå°é¡µã€`manifest` ç­‰ç­‰
- `sessions` æŸ¥è¯¢æˆ–æ¢å¤æµè§ˆä¼šè¯
- `storage` å­˜å‚¨ç›¸å…³
- `tabs` ä¸æ ‡ç­¾é¡µäº¤äº’
- `vpnProvider` å®ç° `vpn` å®¢æˆ·ç«¯éœ€è¦ä½¿ç”¨çš„ä¸œè¥¿
- `webRequest` æ‹¦æˆªã€ä¿®æ”¹ã€é˜»å¡è¯·æ±‚
- `windows` åˆ›å»ºã€ä¿®æ”¹ã€é‡æ’çª—å£

## è¸©å‘

### æŸ¥çœ‹å·²å®‰è£…æ’ä»¶è·¯å¾„

æŸ¥çœ‹æœ¬åœ°å·²å®‰è£…çš„æ’ä»¶æºç è·¯å¾„ `C:\Users\ç”¨æˆ·å\AppData\Local\Google\Chrome\User Data\Default\Extensions`ï¼Œæ¯ä¸€ä¸ªæ’ä»¶è¢«æ”¾åœ¨ä»¥æ’ä»¶ ID ä¸ºåçš„æ–‡ä»¶å¤¹é‡Œé¢ï¼Œæƒ³è¦å­¦ä¹ æŸä¸ªæ’ä»¶çš„æŸä¸ªåŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ï¼Œçœ‹äººå®¶çš„æºç æ˜¯æœ€å¥½çš„æ–¹æ³•äº†ã€‚

> `Mac` ç³»ç»Ÿæ’ä»¶æœ¬åœ°ç¼“å­˜ä½äºï¼š`/Users/ç”¨æˆ·å/Library/Application Support/Google/Chrome/Default/Extensions` æ–‡ä»¶å¤¹

å¦‚ä½•æŸ¥çœ‹æŸä¸ªæ’ä»¶çš„ ID è¿›å…¥ `chrome://extensions` ï¼Œç„¶åå‹¾é€‰å¼€å‘è€…æ¨¡å¼å³å¯çœ‹åˆ°äº†ã€‚

### background çš„æŠ¥é”™

å¾ˆå¤šæ—¶å€™ä½ å‘ç°ä½ çš„ä»£ç ä¼šè«åå…¶å¦™çš„å¤±æ•ˆï¼Œæ‰¾æ¥æ‰¾å»åˆæ‰¾ä¸åˆ°åŸå› ï¼Œè¿™æ—¶æ‰“å¼€ `background` çš„æ§åˆ¶å°æ‰å‘ç°åŸæ¥æŸä¸ªåœ°æ–¹å†™é”™äº†å¯¼è‡´ä»£ç æ²¡ç”Ÿæ•ˆï¼Œè¿™æ˜¯ç”±äº `background`æŠ¥é”™çš„éšè”½æ€§(éœ€è¦ä¸»åŠ¨æ‰“å¼€å¯¹åº”çš„æ§åˆ¶å°æ‰èƒ½çœ‹åˆ°é”™è¯¯)

### å¦‚ä½•è®© popup é¡µé¢ä¸å…³é—­

åœ¨å¯¹ `popup` é¡µé¢å®¡æŸ¥å…ƒç´ çš„æ—¶å€™ `popup` ä¼šè¢«å¼ºåˆ¶æ‰“å¼€æ— æ³•å…³é—­ï¼Œåªæœ‰æ§åˆ¶å°å…³é—­äº†æ‰å¯ä»¥å…³é—­ `popup`ï¼ŒåŸå› å¾ˆç®€å•ï¼šå¦‚æœ `popup` å…³é—­äº†æ§åˆ¶å°å°±æ²¡ç”¨äº†ã€‚è¿™ç§æ–¹æ³•åœ¨æŸäº›æƒ…å†µä¸‹å¾ˆå®ç”¨ï¼

### ä¸æ”¯æŒå†…è” JavaScript çš„æ‰§è¡Œ

å°±æ˜¯ä¸æ”¯æŒå°† js ç›´æ¥å†™åœ¨ html ä¸­ï¼Œä¾‹å¦‚ ğŸŒ°ï¼š

```html
<input id="btn" type="button" value="æŒ‰é’®" onclick="handleBtn()" />

// æŠ¥é”™ // Refused to execute inline event handler because it violates the
following Content Security Policy directive: "script-src 'self' blob:
filesystem: chrome-extension-resource:". Either the 'unsafe-inline' keyword, a
hash ('sha256-...'), or a nonce ('nonce-...') is required to enable inline
execution.
```

åªèƒ½é€šè¿‡ js ç»‘å®šäº‹ä»¶ï¼š

```javascript
$("#btn").on("click", function () {
  alert("æµ‹è¯•");
});
```

å¦å¤–ï¼Œå¯¹äº A æ ‡ç­¾ï¼Œè¿™æ ·å†™ `href="javascript:;"`ç„¶åç”¨ JS ç»‘å®šäº‹ä»¶è™½ç„¶æ§åˆ¶å°ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¸å—å½±å“ï¼Œå½“ç„¶å¼ºè¿«ç—‡æ‚£è€…å—ä¸äº†çš„è¯åªèƒ½å†™æˆ `href="#"`äº†ã€‚

```html
<a href="javascript:;" id="get_res">è¯·æ±‚</a>

// æŠ¥é”™ // Refused to execute JavaScript URL because it violates the following
Content Security Policy directive: "script-src 'self' blob: filesystem:
chrome-extension-resource:". Either the 'unsafe-inline' keyword, a hash
('sha256-...'), or a nonce ('nonce-...') is required to enable inline execution.
```

### æ³¨å…¥ CSS

ç”±äºé€šè¿‡ `content_scripts` æ³¨å…¥çš„ CSS ä¼˜å…ˆçº§éå¸¸é«˜ï¼Œå‡ ä¹ä»…æ¬¡äºæµè§ˆå™¨é»˜è®¤æ ·å¼ï¼Œç¨ä¸æ³¨æ„å¯èƒ½å°±ä¼šå½±å“ä¸€äº›ç½‘ç«™çš„å±•ç¤ºæ•ˆæœï¼Œæ‰€ä»¥å°½é‡ä¸è¦å†™ä¸€äº›å½±å“å…¨å±€çš„æ ·å¼ã€‚

> ä¹‹æ‰€ä»¥å¼ºè°ƒè¿™ä¸ªï¼Œæ˜¯å› ä¸ºè¿™ä¸ªå¸¦æ¥çš„é—®é¢˜éå¸¸éšè”½ï¼Œä¸å¤ªå®¹æ˜“æ‰¾åˆ°ï¼Œå¯èƒ½ä½ æ­£åœ¨å†™æŸä¸ªç½‘é¡µï¼Œæ˜¨å¤©æ ·å¼è¿˜æ˜¯å¥½å¥½çš„ï¼Œæ€ä¹ˆä»Šå¤©å°±çªç„¶ä¸è¡Œäº†ï¼Ÿç„¶åä½ è¾›è¾›è‹¦è‹¦æ‰¾æ¥æ‰¾å»ï¼Œæ‰¾äº†åŠå¤©æ‰å‘ç°ç«Ÿç„¶æ˜¯å› ä¸ºæ’ä»¶é‡Œé¢çš„ä¸€ä¸ªæ ·å¼å½±å“çš„ï¼

---

åŸæ–‡ï¼š[http://blog.haoji.me/chrome-plugin-develop.html#dong-tai-zhu-ru-huo-zhi-xing-JS](http://blog.haoji.me/chrome-plugin-develop.html#dong-tai-zhu-ru-huo-zhi-xing-JS)

## ç›¸å…³èµ„æ–™ï¼š

::: cardList 2

```yaml
- name: 360å®‰å…¨æµè§ˆå™¨å¼€å‘æ–‡æ¡£ï¼ˆæ¨èï¼‰
  desc: ""
  bgColor: "#F0DFB1"
  textColor: "#242A38"
  link: http://open.se.360.cn/open/extension_dev/overview.html
- name: 360æé€Ÿæµè§ˆå™¨Chromeæ‰©å±•å¼€å‘æ–‡æ¡£
  desc: ""
  link: http://open.chrome.360.cn/extension_dev/overview.html
  bgColor: "#DFEEE7"
  textColor: "#2A3344"
- name: Chromeæ‰©å±•å¼€å‘æå®¢
  desc: ""
  link: https://www.cnblogs.com/champagne/p/
  bgColor: "#2bc2d6"
  textColor: "#2A3344"
- name: chromeæ‰©å±•å¼€å‘å®˜æ–¹æ–‡æ¡£ï¼ˆéœ€è¦ç¿»å¢™
  desc: ""
  link: https://developer.chrome.com/extensions
  bgColor: "#2bd64d"
  textColor: "#2A3344"
- name: chrome APIæ”¯æŒï¼ˆéœ€è¦ç¿»å¢™ï¼‰
  desc: ""
  link: https://developer.chrome.com/extensions/api_index
  bgColor: "#b8b823"
  textColor: "#2A3344"
```

:::
